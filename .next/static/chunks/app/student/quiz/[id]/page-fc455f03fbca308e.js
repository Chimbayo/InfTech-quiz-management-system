(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[799],{8207:function(e,s,t){Promise.resolve().then(t.bind(t,5068))},5068:function(e,s,t){"use strict";t.d(s,{QuizInterface:function(){return b}});var l=t(7437),i=t(2265),a=t(9376),n=t(2381),c=t(9820),r=t(6700),d=t(8245),m=t(5060),o=t(5937),x=t(2660),h=t(1723),u=t(3417),j=t(3639),f=t(5302),p=t(5863),N=t(6858),g=t(2489),v=t(1936);function b(e){let{quiz:s,userId:t}=e,b=(0,a.useRouter)(),[w,y]=(0,i.useState)(0),[I,C]=(0,i.useState)([]),[q,S]=(0,i.useState)(null),[z,k]=(0,i.useState)(!1),[O,E]=(0,i.useState)(""),[Z]=(0,i.useState)(Date.now()),[L,_]=(0,i.useState)(!1),[P,T]=(0,i.useState)(null),[M,Q]=(0,i.useState)(!0),U=s.questions[w],D=w===s.questions.length-1,F=0===w;(0,i.useEffect)(()=>{C(s.questions.map(e=>({questionId:e.id,selectedOptionIds:[]})))},[s.questions]),(0,i.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/chat/rooms?quizId=".concat(s.id));if(e.ok){let s=await e.json();if(s.rooms&&s.rooms.length>0){let e=s.rooms.find(e=>"QUIZ_DISCUSSION"===e.type);e&&T(e.id)}}}catch(e){console.error("Error loading quiz chat room:",e)}})()},[s.id]),(0,i.useEffect)(()=>{if(s.timeLimit){S(60*s.timeLimit);let e=setInterval(()=>{S(e=>null===e||e<=1?(A(),0):e-1)},1e3);return()=>clearInterval(e)}},[s.timeLimit]);let H=(e,s)=>{C(t=>{let l=[...t],i=l[w];return"MULTIPLE_CHOICE"===U.type?i.selectedOptionIds=s?[e]:[]:s?i.selectedOptionIds=[e]:i.selectedOptionIds=[],l})},A=async()=>{k(!0),E("");try{let e=Math.floor((Date.now()-Z)/1e3),l=await fetch("/api/quiz-attempts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quizId:s.id,userId:t,answers:I,timeSpent:e})}),i=await l.json();if(!l.ok)throw Error(i.error||"Failed to submit quiz");Q(!1),b.push("/student/quiz/".concat(s.id,"/results"))}catch(e){E(e instanceof Error?e.message:"An error occurred")}finally{k(!1)}},X=()=>{var e;return(null===(e=I[w])||void 0===e?void 0:e.selectedOptionIds)||[]},Y=()=>I.every(e=>e.selectedOptionIds.length>0);return(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,l.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)(n.z,{variant:"ghost",onClick:()=>b.back(),className:"mr-4",children:[(0,l.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Back"]}),(0,l.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:s.title})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[null!==q&&(0,l.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,l.jsx)(h.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:q<300?"text-red-600 font-medium":"",children:"".concat(Math.floor(q/60),":").concat((q%60).toString().padStart(2,"0"))})]}),(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:[I.filter(e=>e.selectedOptionIds.length>0).length,"/",s.questions.length," answered",Y()&&(0,l.jsx)("span",{className:"ml-2 text-green-600 font-medium",children:"âœ“ All answered"})]}),P&&(0,l.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>_(!L),className:M?"opacity-50 cursor-not-allowed":"",disabled:M,title:M?"Chat will be available after quiz completion":"Toggle quiz discussion",children:[(0,l.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),L?"Hide Chat":"Show Chat"]})]})]})})}),(0,l.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[O&&(0,l.jsxs)(o.bZ,{variant:"destructive",className:"mb-6",children:[(0,l.jsx)(j.Z,{className:"h-4 w-4"}),(0,l.jsx)(o.X,{children:O})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,l.jsxs)("span",{children:["Question ",w+1," of ",s.questions.length]}),(0,l.jsxs)("span",{children:[Math.round((w+1)/s.questions.length*100),"% Complete"]})]}),(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:(0,l.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat((w+1)/s.questions.length*100,"%")}})}),(0,l.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,l.jsxs)("span",{children:["Progress: ",w+1,"/",s.questions.length]}),(0,l.jsxs)("span",{children:["Answered: ",I.filter(e=>e.selectedOptionIds.length>0).length,"/",s.questions.length]})]})]}),(0,l.jsxs)(c.Zb,{className:"mb-8",children:[(0,l.jsx)(c.Ol,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)(c.ll,{className:"text-lg",children:U.text}),(0,l.jsx)(c.SZ,{children:"MULTIPLE_CHOICE"===U.type?"Select the correct answer":"Select True or False"})]}),X().length>0&&(0,l.jsx)("div",{className:"ml-4 flex-shrink-0",children:(0,l.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,l.jsx)(f.Z,{className:"h-5 w-5 text-green-600"})})})]})}),(0,l.jsx)(c.aY,{children:"MULTIPLE_CHOICE"===U.type?(0,l.jsx)(r.E,{value:X()[0]||"",onValueChange:e=>H(e,!0),children:U.options.map(e=>(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(r.m,{value:e.id,id:e.id}),(0,l.jsx)(m._,{htmlFor:e.id,className:"flex-1 cursor-pointer",children:e.text})]},e.id))}):(0,l.jsx)("div",{className:"space-y-3",children:U.options.map(e=>(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(d.X,{id:e.id,checked:X().includes(e.id),onCheckedChange:s=>H(e.id,!!s)}),(0,l.jsx)(m._,{htmlFor:e.id,className:"flex-1 cursor-pointer",children:e.text})]},e.id))})})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsxs)(n.z,{variant:"outline",onClick:()=>{F||y(e=>e-1)},disabled:F,children:[(0,l.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Previous"]}),(0,l.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[D&&!Y()&&(0,l.jsxs)("div",{className:"text-sm text-amber-600 bg-amber-50 px-3 py-2 rounded-lg border border-amber-200",children:[(0,l.jsx)(j.Z,{className:"h-4 w-4 inline mr-2"}),"Please answer all ",s.questions.length," questions before submitting (",I.filter(e=>e.selectedOptionIds.length>0).length,"/",s.questions.length," answered)"]}),(0,l.jsx)("div",{className:"flex space-x-4",children:D?(0,l.jsxs)(n.z,{onClick:A,disabled:z||!Y(),children:[z&&(0,l.jsx)(p.Z,{className:"mr-2 h-4 w-4 animate-spin"}),(0,l.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Submit Quiz"]}):(0,l.jsxs)(n.z,{onClick:()=>{D||y(e=>e+1)},children:["Next",(0,l.jsx)(N.Z,{className:"h-4 w-4 ml-2"})]})})]})]}),(0,l.jsx)(c.Zb,{className:"mt-8",children:(0,l.jsx)(c.aY,{className:"p-6",children:(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Total Questions:"}),(0,l.jsx)("span",{className:"ml-2 font-medium",children:s.questions.length})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Passing Score:"}),(0,l.jsxs)("span",{className:"ml-2 font-medium",children:[s.passingScore,"%"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Time Limit:"}),(0,l.jsx)("span",{className:"ml-2 font-medium",children:s.timeLimit?"".concat(s.timeLimit," minutes"):"No limit"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Created by:"}),(0,l.jsx)("span",{className:"ml-2 font-medium",children:s.creator.name})]})]})})})]}),L&&P&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl h-[80vh] flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,l.jsxs)("h3",{className:"text-lg font-semibold",children:["Quiz Discussion - ",s.title]}),(0,l.jsx)(n.z,{variant:"ghost",size:"sm",onClick:()=>_(!1),children:(0,l.jsx)(g.Z,{className:"h-4 w-4"})})]}),(0,l.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,l.jsx)(v.N,{roomId:P,userId:t})})]})})]})}}},function(e){e.O(0,[284,265,974,722,971,117,744],function(){return e(e.s=8207)}),_N_E=e.O()}]);