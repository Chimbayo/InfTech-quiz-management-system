(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[708],{7442:function(e,s,l){Promise.resolve().then(l.bind(l,5801))},5801:function(e,s,l){"use strict";l.d(s,{QuizInterfaceWithChat:function(){return w}});var a=l(7437),i=l(2265),t=l(9376),n=l(2381),c=l(9820),r=l(6700),d=l(8245),m=l(5060),x=l(5937),h=l(9174),o=l(2660),u=l(3417),j=l(5302),N=l(2489),f=l(1723),p=l(3639),b=l(5863),g=l(6858),v=l(1936);function w(e){let{quiz:s,userId:l,chatRooms:w=[]}=e,y=(0,t.useRouter)(),[C,z]=(0,i.useState)(0),[I,S]=(0,i.useState)([]),[Z,q]=(0,i.useState)(null),[k,O]=(0,i.useState)(!1),[E,L]=(0,i.useState)(""),[Q]=(0,i.useState)(Date.now()),[_,P]=(0,i.useState)(!1),[T,D]=(0,i.useState)(null),[M,Y]=(0,i.useState)(!1),[A,F]=(0,i.useState)(!1),H=s.questions[C],R=C===s.questions.length-1,U=0===C,X=M&&!A;(0,i.useEffect)(()=>{S(s.questions.map(e=>({questionId:e.id,selectedOptionIds:[]})))},[s.questions]),(0,i.useEffect)(()=>{if(s.timeLimit&&M){q(60*s.timeLimit);let e=setInterval(()=>{q(e=>null===e||e<=1?(B(),0):e-1)},1e3);return()=>clearInterval(e)}},[s.timeLimit,M]),(0,i.useEffect)(()=>{if(w.length>0&&!T){let e=w.find(e=>"QUIZ"===e.type);D((null==e?void 0:e.id)||w[0].id)}},[w,T]);let V=(e,s)=>{S(l=>{let a=[...l],i=a[C];return"MULTIPLE_CHOICE"===H.type?i.selectedOptionIds=s?[e]:[]:s?i.selectedOptionIds=[e]:i.selectedOptionIds=[],a})},B=async()=>{O(!0),L("");try{let e=Math.floor((Date.now()-Q)/1e3),a=await fetch("/api/quiz-attempts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quizId:s.id,userId:l,answers:I,timeSpent:e})}),i=await a.json();if(!a.ok)throw Error(i.error||"Failed to submit quiz");F(!0),P(!0),setTimeout(()=>{y.push("/student/quiz/".concat(s.id,"/results"))},2e3)}catch(e){L(e instanceof Error?e.message:"An error occurred")}finally{O(!1)}},J=()=>{var e;return(null===(e=I[C])||void 0===e?void 0:e.selectedOptionIds)||[]},W=()=>I.every(e=>e.selectedOptionIds.length>0);return M?A?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16",children:(0,a.jsx)(c.Zb,{children:(0,a.jsxs)(c.aY,{className:"text-center py-16",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)(j.Z,{className:"h-10 w-10 text-green-600"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Quiz Completed!"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Your answers have been submitted successfully. You'll be redirected to see your results shortly."}),s.enableChat&&(0,a.jsx)("p",{className:"text-sm text-green-600 mb-4",children:"Chat is now available for post-quiz discussions."}),(0,a.jsx)(n.z,{onClick:()=>y.push("/student/quiz/".concat(s.id,"/results")),className:"btn-primary-professional",children:"View Results"})]})})})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:s.title}),X&&s.enableChat&&(0,a.jsxs)(h.C,{variant:"secondary",className:"ml-4",children:[(0,a.jsx)(u.Z,{className:"h-3 w-3 mr-1"}),"Chat Disabled During Quiz"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[null!==Z&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:Z<300?"text-red-600 font-medium":"",children:"".concat(Math.floor(Z/60),":").concat((Z%60).toString().padStart(2,"0"))})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[I.filter(e=>e.selectedOptionIds.length>0).length,"/",s.questions.length," answered",W()&&(0,a.jsx)("span",{className:"ml-2 text-green-600 font-medium",children:"âœ“ All answered"})]})]})]})})}),(0,a.jsxs)("div",{className:"flex ".concat(_?"h-screen":""),children:[(0,a.jsx)("div",{className:"".concat(_?"flex-1":"w-full"," overflow-auto"),children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[E&&(0,a.jsxs)(x.bZ,{variant:"destructive",className:"mb-6",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4"}),(0,a.jsx)(x.X,{children:E})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,a.jsxs)("span",{children:["Question ",C+1," of ",s.questions.length]}),(0,a.jsxs)("span",{children:[Math.round((C+1)/s.questions.length*100),"% Complete"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat((C+1)/s.questions.length*100,"%")}})})]}),(0,a.jsxs)(c.Zb,{className:"mb-8",children:[(0,a.jsx)(c.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(c.ll,{className:"text-lg",children:H.text}),(0,a.jsx)(c.SZ,{children:"MULTIPLE_CHOICE"===H.type?"Select the correct answer":"Select True or False"})]}),J().length>0&&(0,a.jsx)("div",{className:"ml-4 flex-shrink-0",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(j.Z,{className:"h-5 w-5 text-green-600"})})})]})}),(0,a.jsx)(c.aY,{children:"MULTIPLE_CHOICE"===H.type?(0,a.jsx)(r.E,{value:J()[0]||"",onValueChange:e=>V(e,!0),children:H.options.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(r.m,{value:e.id,id:e.id}),(0,a.jsx)(m._,{htmlFor:e.id,className:"flex-1 cursor-pointer",children:e.text})]},e.id))}):(0,a.jsx)("div",{className:"space-y-3",children:H.options.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(d.X,{id:e.id,checked:J().includes(e.id),onCheckedChange:s=>V(e.id,!!s)}),(0,a.jsx)(m._,{htmlFor:e.id,className:"flex-1 cursor-pointer",children:e.text})]},e.id))})})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)(n.z,{variant:"outline",onClick:()=>{U||z(e=>e-1)},disabled:U,children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Previous"]}),(0,a.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[R&&!W()&&(0,a.jsxs)("div",{className:"text-sm text-amber-600 bg-amber-50 px-3 py-2 rounded-lg border border-amber-200",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 inline mr-2"}),"Please answer all ",s.questions.length," questions before submitting (",I.filter(e=>e.selectedOptionIds.length>0).length,"/",s.questions.length," answered)"]}),(0,a.jsx)("div",{className:"flex space-x-4",children:R?(0,a.jsxs)(n.z,{onClick:B,disabled:k||!W(),children:[k&&(0,a.jsx)(b.Z,{className:"mr-2 h-4 w-4 animate-spin"}),(0,a.jsx)(j.Z,{className:"mr-2 h-4 w-4"}),"Submit Quiz"]}):(0,a.jsxs)(n.z,{onClick:()=>{R||z(e=>e+1)},children:["Next",(0,a.jsx)(g.Z,{className:"h-4 w-4 ml-2"})]})})]})]})]})}),_&&s.enableChat&&!X&&T&&(0,a.jsx)("div",{className:"w-96 border-l bg-white",children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b bg-gray-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-medium",children:"Quiz Discussion"}),(0,a.jsx)(n.z,{variant:"ghost",size:"sm",onClick:()=>P(!1),children:(0,a.jsx)(N.Z,{className:"h-4 w-4"})})]})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(v.N,{roomId:T,userId:l})})]})})]})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)(n.z,{variant:"ghost",onClick:()=>y.back(),className:"mr-4",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Back"]}),(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:s.title})]}),s.enableChat&&w.length>0&&(0,a.jsxs)(n.z,{variant:"outline",onClick:()=>{X||P(!_)},className:"btn-secondary-professional",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),_?"Hide Chat":"Show Chat"]})]})})}),(0,a.jsxs)("div",{className:"flex ".concat(_?"h-screen":""),children:[(0,a.jsx)("div",{className:"".concat(_?"flex-1":"w-full"," overflow-auto"),children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)(c.Zb,{className:"mb-8",children:[(0,a.jsxs)(c.Ol,{children:[(0,a.jsx)(c.ll,{className:"text-2xl",children:"Ready to Start?"}),(0,a.jsx)(c.SZ,{children:'Review the quiz details below and click "Start Quiz" when you\'re ready.'})]}),(0,a.jsxs)(c.aY,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Questions:"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:s.questions.length})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Passing Score:"}),(0,a.jsxs)("span",{className:"ml-2 font-medium",children:[s.passingScore,"%"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Time Limit:"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:s.timeLimit?"".concat(s.timeLimit," minutes"):"No limit"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Created by:"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:s.creator.name})]}),s.enableChat&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Chat:"}),(0,a.jsxs)(h.C,{variant:"default",className:"ml-2 bg-green-100 text-green-800",children:[(0,a.jsx)(u.Z,{className:"h-3 w-3 mr-1"}),"Available for discussion"]})]})]})]}),s.enableChat&&(0,a.jsxs)(x.bZ,{className:"mb-6",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4"}),(0,a.jsxs)(x.X,{children:[(0,a.jsx)("strong",{children:"Academic Integrity Notice:"})," Chat will be disabled during the quiz attempt to maintain academic integrity. You can use chat before starting and after completing the quiz for discussions and questions."]})]}),(0,a.jsxs)(n.z,{onClick:()=>{Y(!0),P(!1)},size:"lg",className:"btn-primary-professional",children:[(0,a.jsx)(j.Z,{className:"h-5 w-5 mr-2"}),"Start Quiz"]})]})]})})}),_&&s.enableChat&&T&&(0,a.jsx)("div",{className:"w-96 border-l bg-white",children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-medium",children:"Quiz Discussion"}),(0,a.jsx)(n.z,{variant:"ghost",size:"sm",onClick:()=>P(!1),children:(0,a.jsx)(N.Z,{className:"h-4 w-4"})})]}),w.length>1&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("select",{value:T,onChange:e=>D(e.target.value),className:"w-full text-sm border rounded px-2 py-1",children:w.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))})})]}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(v.N,{roomId:T,userId:l})})]})})]})]})}}},function(e){e.O(0,[284,265,974,722,971,117,744],function(){return e(e.s=7442)}),_N_E=e.O()}]);