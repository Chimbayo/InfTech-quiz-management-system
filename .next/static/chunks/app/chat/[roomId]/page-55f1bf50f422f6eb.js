(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[604],{5849:function(e,s,t){Promise.resolve().then(t.bind(t,8133))},8133:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return A}});var r=t(7437),a=t(2265),n=t(9376),l=t(2381),i=t(8734),o=t(3417),c=t(2660),d=t(5805),u=t(2926),m=t(5395),x=t(7684),f=t(8098),h=t(8867),g=t(1422),p=t(4630),j=t(8930),y=t(4743),b=t(279),v=t(9174),N=t(3795),w=t(641),k=t(85),C=t(407),D=t(401),E=t(519),S=t(3448);let T=k.fC,z=k.xz;k.ZA,k.Uv,k.Tr,k.Ee,a.forwardRef((e,s)=>{let{className:t,inset:a,children:n,...l}=e;return(0,r.jsxs)(k.fF,{ref:s,className:(0,S.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",a&&"pl-8",t),...l,children:[n,(0,r.jsx)(C.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=k.fF.displayName,a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(k.tu,{ref:s,className:(0,S.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a})}).displayName=k.tu.displayName;let R=a.forwardRef((e,s)=>{let{className:t,sideOffset:a=4,...n}=e;return(0,r.jsx)(k.Uv,{children:(0,r.jsx)(k.VY,{ref:s,sideOffset:a,className:(0,S.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})})});R.displayName=k.VY.displayName;let Z=a.forwardRef((e,s)=>{let{className:t,inset:a,...n}=e;return(0,r.jsx)(k.ck,{ref:s,className:(0,S.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",t),...n})});Z.displayName=k.ck.displayName,a.forwardRef((e,s)=>{let{className:t,children:a,checked:n,...l}=e;return(0,r.jsxs)(k.oC,{ref:s,className:(0,S.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:n,...l,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(k.wU,{children:(0,r.jsx)(D.Z,{className:"h-4 w-4"})})}),a]})}).displayName=k.oC.displayName,a.forwardRef((e,s)=>{let{className:t,children:a,...n}=e;return(0,r.jsxs)(k.Rk,{ref:s,className:(0,S.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(k.wU,{children:(0,r.jsx)(E.Z,{className:"h-2 w-2 fill-current"})})}),a]})}).displayName=k.Rk.displayName,a.forwardRef((e,s)=>{let{className:t,inset:a,...n}=e;return(0,r.jsx)(k.__,{ref:s,className:(0,S.cn)("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",t),...n})}).displayName=k.__.displayName;let I=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(k.Z0,{ref:s,className:(0,S.cn)("-mx-1 my-1 h-px bg-muted",t),...a})});function _(e){let{roomId:s,userId:t}=e,[n,i]=(0,a.useState)([]),[c,k]=(0,a.useState)(""),[C,D]=(0,a.useState)(!1),[E,S]=(0,a.useState)(null),[_,A]=(0,a.useState)([]),[U,M]=(0,a.useState)([]),[O,L]=(0,a.useState)(null),[F,P]=(0,a.useState)(""),[V,B]=(0,a.useState)(null),[K,q]=(0,a.useState)(""),[W,J]=(0,a.useState)(""),[Y,H]=(0,a.useState)(""),Q=(0,a.useRef)(null),X=(0,a.useRef)(),{socket:G,isConnected:$}=(0,N.s)();(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/session");if(e.ok){let s=await e.json();(null==s?void 0:s.user)&&(J(s.user.name||""),H(s.user.role||"STUDENT"))}}catch(e){console.error("Error fetching user data:",e)}})()},[]),(0,a.useEffect)(()=>{s&&(es(),ee())},[s]),(0,a.useEffect)(()=>{if(G&&s)return G.emit("join-room",s),G.on("new-message",e=>{i(s=>[...s,e])}),G.on("user-typing",e=>{let{userId:s,userName:r}=e;s!==t&&A(e=>e.includes(r)?e:[...e,r])}),G.on("user-stopped-typing",e=>{let{userId:s,userName:t}=e;A(e=>e.filter(e=>e!==t))}),G.on("room-users",e=>{M(e)}),G.on("message-status",e=>{let{messageId:s,status:t}=e;i(e=>e.map(e=>e.id===s?{...e,status:t}:e))}),()=>{G.off("new-message"),G.off("user-typing"),G.off("user-stopped-typing"),G.off("room-users"),G.off("message-status"),G.emit("leave-room",s)}},[G,s,t]),(0,a.useEffect)(()=>{var e;null===(e=Q.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[n]);let ee=async()=>{try{let e=await fetch("/api/chat/rooms/".concat(s,"/messages"));if(e.ok){let s=await e.json();i(Array.isArray(s)?s:s.messages||[])}}catch(e){console.error("Error fetching messages:",e)}},es=async()=>{try{let e=await fetch("/api/chat/rooms/".concat(s));if(e.ok){let s=await e.json();S(s)}}catch(e){console.error("Error fetching room:",e)}},et=(0,a.useCallback)(async()=>{if(!c.trim()||C||!$)return;let e="temp-".concat(Date.now()),r={id:e,content:c,user:{id:t,name:W,role:Y},createdAt:new Date().toISOString(),isSystemMessage:!1,status:"sending",replyTo:V?{id:V.id,content:V.content||V.message||"",user:{name:V.user.name}}:void 0};i(e=>[...e,r]),k(""),B(null),D(!0);try{G&&G.emit("send-message",{roomId:s,content:c,replyToId:null==V?void 0:V.id,tempId:e})}catch(s){console.error("Error sending message:",s),i(s=>s.filter(s=>s.id!==e))}finally{D(!1)}},[c,C,$,G,s,t,W,Y,V]),er=async(e,t)=>{try{let r=await fetch("/api/chat/messages/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t})});if(r.ok){let a=await r.json();i(s=>s.map(s=>s.id===e?{...s,...a,isEdited:!0}:s)),G&&G.emit("message-edited",{roomId:s,messageId:e,newContent:t,updatedMessage:a}),L(null),P("")}}catch(e){console.error("Error editing message:",e)}},ea=async e=>{try{(await fetch("/api/chat/messages/".concat(e),{method:"DELETE"})).ok&&(i(s=>s.map(s=>s.id===e?{...s,isDeleted:!0,content:"This message was deleted"}:s)),G&&G.emit("message-deleted",{roomId:s,messageId:e}))}catch(e){console.error("Error deleting message:",e)}},en=async(e,r)=>{try{let a=await fetch("/api/chat/messages/".concat(e,"/react"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:r})});if(a.ok){let n=await a.json();i(s=>s.map(s=>s.id===e?{...s,reactions:n}:s)),G&&G.emit("message-reaction",{roomId:s,messageId:e,emoji:r,userId:t})}}catch(e){console.error("Error reacting to message:",e)}},el=e=>{B(e)},ei=e=>{navigator.clipboard.writeText(e)},eo=()=>{G&&s&&(G.emit("typing",{roomId:s,userId:t}),X.current&&clearTimeout(X.current),X.current=setTimeout(()=>{G.emit("stop-typing",{roomId:s,userId:t})},1e3))},ec=e=>{let s=new Date(e);return(new Date().getTime()-s.getTime())/36e5<24?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.toLocaleDateString([],{month:"short",day:"numeric"})},ed=e=>{switch(e){case"sending":return(0,r.jsx)("div",{className:"w-3 h-3 border border-current border-t-transparent rounded-full animate-spin"});case"sent":return(0,r.jsx)("div",{className:"w-3 h-3 rounded-full bg-gray-400"});case"delivered":return(0,r.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-400"});case"read":return(0,r.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-400"});default:return null}};return(0,r.jsxs)("div",{className:"flex flex-col h-full bg-white rounded-lg border shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b bg-gray-50 rounded-t-lg",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,r.jsx)(o.Z,{className:"h-5 w-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:(null==E?void 0:E.name)||"Loading..."}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[$?(0,r.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,r.jsx)(u.Z,{className:"h-3 w-3 mr-1"}),(0,r.jsx)("span",{className:"text-xs",children:"Connected"})]}):(0,r.jsxs)("div",{className:"flex items-center text-red-600",children:[(0,r.jsx)(m.Z,{className:"h-3 w-3 mr-1"}),(0,r.jsx)("span",{className:"text-xs",children:"Connecting..."})]}),(0,r.jsxs)(v.C,{variant:"secondary",className:"text-xs",children:[(0,r.jsx)(d.Z,{className:"h-3 w-3 mr-1"}),U.length," online"]})]})]})]}),(0,r.jsxs)(T,{children:[(0,r.jsx)(z,{asChild:!0,children:(0,r.jsx)(l.z,{variant:"ghost",size:"sm",children:(0,r.jsx)(x.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(R,{align:"end",children:(0,r.jsx)(Z,{onClick:ee,children:"Refresh Messages"})})]})]}),(0,r.jsx)(w.x,{className:"flex-1 p-4",children:(0,r.jsxs)("div",{className:"space-y-4",children:[0===n.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(o.Z,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"No messages yet. Start the conversation!"})]}):n.map((e,s)=>{let a=e.user.id===t,i=0===s||n[s-1].user.id!==e.user.id,o=O===e.id;return(0,r.jsx)("div",{className:"flex ".concat(a?"justify-end":"justify-start"," group"),children:(0,r.jsxs)("div",{className:"flex items-end space-x-2 max-w-xs lg:max-w-md ".concat(a?"flex-row-reverse space-x-reverse":""),children:[!a&&i&&(0,r.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full flex items-center justify-center text-white text-sm font-medium",children:e.user.name.charAt(0).toUpperCase()}),!a&&!i&&(0,r.jsx)("div",{className:"w-8 h-8"}),(0,r.jsxs)("div",{className:"relative",children:[e.replyTo&&(0,r.jsxs)("div",{className:"mb-1 p-2 rounded-lg border-l-4 ".concat(a?"border-blue-300 bg-blue-50":"border-gray-300 bg-gray-50"),children:[(0,r.jsxs)("div",{className:"text-xs font-medium text-gray-600",children:["Replying to ",e.replyTo.user.name]}),(0,r.jsx)("div",{className:"text-xs text-gray-500 truncate",children:e.replyTo.content})]}),(0,r.jsxs)("div",{className:"px-4 py-2 rounded-2xl relative ".concat(e.isDeleted?"bg-gray-100 text-gray-500 italic":a?"bg-blue-600 text-white rounded-br-md":e.isSystemMessage?"bg-yellow-100 text-yellow-800 border border-yellow-200":"bg-gray-100 text-gray-900 rounded-bl-md"),children:[!e.isSystemMessage&&!e.isDeleted&&(0,r.jsx)("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,r.jsxs)(T,{children:[(0,r.jsx)(z,{asChild:!0,children:(0,r.jsx)(l.z,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:(0,r.jsx)(x.Z,{className:"h-3 w-3"})})}),(0,r.jsxs)(R,{align:"end",children:[(0,r.jsxs)(Z,{onClick:()=>el(e),children:[(0,r.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"Reply"]}),(0,r.jsxs)(Z,{onClick:()=>ei(e.content||e.message||""),children:[(0,r.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"Copy"]}),(0,r.jsx)(I,{}),(0,r.jsxs)(Z,{onClick:()=>en(e.id,"\uD83D\uDC4D"),children:[(0,r.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"\uD83D\uDC4D"]}),(0,r.jsxs)(Z,{onClick:()=>en(e.id,"❤️"),children:[(0,r.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"❤️"]}),(0,r.jsxs)(Z,{onClick:()=>en(e.id,"\uD83D\uDE02"),children:[(0,r.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"\uD83D\uDE02"]}),(0,r.jsxs)(Z,{onClick:()=>en(e.id,"\uD83D\uDE2E"),children:[(0,r.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"\uD83D\uDE2E"]}),(0,r.jsxs)(Z,{onClick:()=>en(e.id,"\uD83D\uDE22"),children:[(0,r.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"\uD83D\uDE22"]}),a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(I,{}),(0,r.jsxs)(Z,{onClick:()=>{L(e.id),P(e.content||e.message||"")},children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,r.jsxs)(Z,{onClick:()=>ea(e.id),className:"text-red-600",children:[(0,r.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})}),!a&&!e.isSystemMessage&&i&&(0,r.jsxs)("div",{className:"text-xs font-medium mb-1 text-gray-600",children:[e.user.name,"ADMIN"===e.user.role&&(0,r.jsx)(v.C,{variant:"secondary",className:"ml-1 text-xs",children:"Admin"}),"TEACHER"===e.user.role&&(0,r.jsx)(v.C,{variant:"secondary",className:"ml-1 text-xs",children:"Teacher"})]}),o?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(b.I,{value:F,onChange:e=>P(e.target.value),onKeyPress:s=>{"Enter"===s.key?er(e.id,F):"Escape"===s.key&&(L(null),P(""))},className:"text-sm"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(l.z,{size:"sm",onClick:()=>er(e.id,F),children:"Save"}),(0,r.jsx)(l.z,{size:"sm",variant:"outline",onClick:()=>{L(null),P("")},children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"break-words whitespace-pre-wrap",children:[e.content||e.message,e.isEdited&&(0,r.jsx)("span",{className:"text-xs opacity-70 ml-2",children:"(edited)"})]}),e.reactions&&e.reactions.length>0&&(0,r.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:e.reactions.map((s,t)=>(0,r.jsxs)("button",{onClick:()=>en(e.id,s.emoji),className:"flex items-center space-x-1 bg-gray-200 hover:bg-gray-300 rounded-full px-2 py-1 text-xs transition-colors",children:[(0,r.jsx)("span",{children:s.emoji}),(0,r.jsx)("span",{children:s.count})]},t))}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-1 text-xs ".concat(a?"text-blue-100":"text-gray-500"),children:[(0,r.jsx)("span",{children:ec(e.createdAt)}),a&&(0,r.jsx)("div",{className:"ml-2",children:ed(e.status)})]})]})]})]})},e.id)}),_.length>0&&(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("div",{className:"w-1 h-1 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,r.jsx)("div",{className:"w-1 h-1 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,r.jsx)("div",{className:"w-1 h-1 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})}),(0,r.jsx)("div",{className:"bg-gray-100 px-3 py-2 rounded-2xl rounded-bl-md",children:(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:[_.join(", ")," ",1===_.length?"is":"are"," typing..."]})})]})}),(0,r.jsx)("div",{ref:Q})]})}),(0,r.jsxs)("div",{className:"p-4 border-t bg-gray-50 rounded-b-lg",children:[V&&(0,r.jsx)("div",{className:"mb-3 p-3 bg-blue-50 border-l-4 border-blue-400 rounded",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"text-xs font-medium text-blue-700",children:["Replying to ",V.user.name]}),(0,r.jsx)("div",{className:"text-sm text-blue-600 truncate",children:V.content||V.message})]}),(0,r.jsx)(l.z,{variant:"ghost",size:"sm",onClick:()=>B(null),className:"h-6 w-6 p-0 text-blue-600",children:"\xd7"})]})}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(b.I,{value:c,onChange:e=>k(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey?eo():(e.preventDefault(),et())},placeholder:V?"Reply to message...":"Type a message...",disabled:C||!$,className:"flex-1 bg-white"}),(0,r.jsx)(l.z,{onClick:et,disabled:!c.trim()||C||!$,className:"bg-blue-600 hover:bg-blue-700",children:C?(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,r.jsx)(y.Z,{className:"h-4 w-4"})})]}),!$&&(0,r.jsx)("p",{className:"text-xs text-red-600 mt-2",children:"Connection lost. Trying to reconnect..."})]})]})}function A(e){let{params:s}=e,t=(0,n.useRouter)(),{user:u,loading:m}=(0,i.a)(),[x,f]=(0,a.useState)(null),[h,g]=(0,a.useState)(!0);(0,a.useEffect)(()=>{s.roomId&&p()},[s.roomId]);let p=async()=>{try{let e=await fetch("/api/chat/rooms/".concat(s.roomId));if(e.ok){let s=await e.json();f(s)}else t.push("/chat")}catch(e){console.error("Error fetching room:",e),t.push("/chat")}finally{g(!1)}},j=()=>{t.push("/chat")};return m||h?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading chat room..."})]})}):u?x?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b sticky top-0 z-50",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsx)("div",{className:"flex justify-between items-center h-16",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)(l.z,{variant:"ghost",onClick:j,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4"}),"Back to Rooms"]}),(0,r.jsx)("div",{className:"h-6 w-px bg-gray-300"}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-600 to-blue-700 rounded-full flex items-center justify-center",children:(0,r.jsx)(o.Z,{className:"h-5 w-5 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:x.name}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:["Created by ",x.creator.name]}),x.quiz&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:"•"}),(0,r.jsxs)("span",{children:["Quiz: ",x.quiz.title]})]})]})]})]})]})})})}),(0,r.jsx)("div",{className:"flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-6",children:(0,r.jsx)("div",{className:"h-[calc(100vh-140px)]",children:(0,r.jsx)(_,{roomId:s.roomId,userId:u.id})})})]}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(o.Z,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Room Not Found"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"The chat room you're looking for doesn't exist."}),(0,r.jsx)(l.z,{onClick:j,children:"Back to Chat"})]})}):(t.push("/"),null)}I.displayName=k.Z0.displayName},9174:function(e,s,t){"use strict";t.d(s,{C:function(){return i}});var r=t(7437);t(2265);var a=t(535),n=t(3448);let l=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)(l({variant:t}),s),...a})}},2381:function(e,s,t){"use strict";t.d(s,{z:function(){return c}});var r=t(7437),a=t(2265),n=t(7053),l=t(535),i=t(3448);let o=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,s)=>{let{className:t,variant:a,size:l,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,r.jsx)(u,{className:(0,i.cn)(o({variant:a,size:l,className:t})),ref:s,...d})});c.displayName="Button"},279:function(e,s,t){"use strict";t.d(s,{I:function(){return l}});var r=t(7437),a=t(2265),n=t(3448);let l=a.forwardRef((e,s)=>{let{className:t,type:a,...l}=e;return(0,r.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...l})});l.displayName="Input"},641:function(e,s,t){"use strict";t.d(s,{x:function(){return i}});var r=t(7437),a=t(2265),n=t(3643),l=t(3448);let i=a.forwardRef((e,s)=>{let{className:t,children:a,...i}=e;return(0,r.jsxs)(n.fC,{ref:s,className:(0,l.cn)("relative overflow-hidden",t),...i,children:[(0,r.jsx)(n.l_,{className:"h-full w-full rounded-[inherit]",children:a}),(0,r.jsx)(o,{}),(0,r.jsx)(n.Ns,{})]})});i.displayName=n.fC.displayName;let o=a.forwardRef((e,s)=>{let{className:t,orientation:a="vertical",...i}=e;return(0,r.jsx)(n.gb,{ref:s,orientation:a,className:(0,l.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...i,children:(0,r.jsx)(n.q4,{className:"relative flex-1 rounded-full bg-border"})})});o.displayName=n.gb.displayName},8734:function(e,s,t){"use strict";t.d(s,{a:function(){return a}});var r=t(2265);function a(){let[e,s]=(0,r.useState)(null),[t,a]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();s(t)}}catch(e){console.error("Failed to fetch user session:",e)}finally{a(!1)}})()},[]),{user:e,loading:t}}},3795:function(e,s,t){"use strict";t.d(s,{s:function(){return o}});var r=t(2265),a=t(8680),n=t(257);let l=null,i=0;function o(e){let[s,t]=(0,r.useState)(null),[o,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)([]),m=(0,r.useRef)(),x=(0,r.useRef)(0),f=(0,r.useCallback)(()=>{if(l&&l.connected){t(l),c(!0);return}if(l&&!l.connected&&!1===l.disconnected){t(l);return}l||(console.log("Creating new WebSocket connection"),(l=(0,a.io)(n.env.NEXT_PUBLIC_SOCKET_URL||window.location.origin,{path:"/api/socketio",transports:["websocket","polling"],upgrade:!0,rememberUpgrade:!0,timeout:2e4,forceNew:!1,reconnection:!1})).on("connect",()=>{console.log("Connected to server"),x.current=0,c(!0),m.current&&clearTimeout(m.current)}),l.on("disconnect",e=>{if(console.log("Disconnected from server:",e),c(!1),("io server disconnect"===e||"transport close"===e)&&x.current<5){let e=1e3*Math.pow(2,x.current);m.current=setTimeout(()=>{console.log("Attempting to reconnect... (".concat(x.current+1,"/").concat(5,")")),x.current++,l&&l.connect()},e)}else x.current>=5&&console.log("Max reconnection attempts reached. Stopping reconnection.")}),l.on("connect_error",e=>{console.error("Connection error:",e),c(!1)})),t(l)},[]);(0,r.useEffect)(()=>(i++,f(),()=>{i--,m.current&&clearTimeout(m.current),0===i&&l&&(console.log("Closing global WebSocket connection"),l.close(),l=null)}),[]);let h=(0,r.useCallback)((e,t)=>{s&&s.on(e,t)},[s]),g=(0,r.useCallback)((e,t)=>{s&&(t?s.off(e,t):s.off(e))},[s]),p=(0,r.useCallback)((t,r)=>{s&&o&&s.emit("join-study-session",{sessionId:t,userId:r||(null==e?void 0:e.userId)})},[s,o,null==e?void 0:e.userId]),j=(0,r.useCallback)((t,r)=>{s&&o&&s.emit("leave-study-session",{sessionId:t,userId:r||(null==e?void 0:e.userId)})},[s,o,null==e?void 0:e.userId]),y=(0,r.useCallback)((t,r,a,n)=>{s&&o&&s.emit("study-session-update",{sessionId:t,updateType:r,content:a,userId:n||(null==e?void 0:e.userId)})},[s,o,null==e?void 0:e.userId]);return{socket:s,isConnected:o,connect:f,on:h,off:g,joinStudySession:p,leaveStudySession:j,sendStudySessionUpdate:y,recentAnnouncements:d}}},3448:function(e,s,t){"use strict";t.d(s,{cn:function(){return n}});var r=t(1994),a=t(3335);function n(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,a.m6)((0,r.W)(s))}}},function(e){e.O(0,[284,265,705,829,980,13,971,117,744],function(){return e(e.s=5849)}),_N_E=e.O()}]);