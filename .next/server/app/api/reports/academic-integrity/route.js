"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/reports/academic-integrity/route";
exports.ids = ["app/api/reports/academic-integrity/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Freports%2Facademic-integrity%2Froute&page=%2Fapi%2Freports%2Facademic-integrity%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Freports%2Facademic-integrity%2Froute.ts&appDir=C%3A%5CUsers%5CHP%5CDocuments%5CInfTech-quiz-management-system%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CHP%5CDocuments%5CInfTech-quiz-management-system&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Freports%2Facademic-integrity%2Froute&page=%2Fapi%2Freports%2Facademic-integrity%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Freports%2Facademic-integrity%2Froute.ts&appDir=C%3A%5CUsers%5CHP%5CDocuments%5CInfTech-quiz-management-system%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CHP%5CDocuments%5CInfTech-quiz-management-system&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_HP_Documents_InfTech_quiz_management_system_src_app_api_reports_academic_integrity_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/reports/academic-integrity/route.ts */ \"(rsc)/./src/app/api/reports/academic-integrity/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/reports/academic-integrity/route\",\n        pathname: \"/api/reports/academic-integrity\",\n        filename: \"route\",\n        bundlePath: \"app/api/reports/academic-integrity/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\HP\\\\Documents\\\\InfTech-quiz-management-system\\\\src\\\\app\\\\api\\\\reports\\\\academic-integrity\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_HP_Documents_InfTech_quiz_management_system_src_app_api_reports_academic_integrity_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/reports/academic-integrity/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZyZXBvcnRzJTJGYWNhZGVtaWMtaW50ZWdyaXR5JTJGcm91dGUmcGFnZT0lMkZhcGklMkZyZXBvcnRzJTJGYWNhZGVtaWMtaW50ZWdyaXR5JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGcmVwb3J0cyUyRmFjYWRlbWljLWludGVncml0eSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNIUCU1Q0RvY3VtZW50cyU1Q0luZlRlY2gtcXVpei1tYW5hZ2VtZW50LXN5c3RlbSU1Q3NyYyU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDSFAlNUNEb2N1bWVudHMlNUNJbmZUZWNoLXF1aXotbWFuYWdlbWVudC1zeXN0ZW0maXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzhEO0FBQzNJO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcXVpei1tYW5hZ2VtZW50LXN5c3RlbS8/MDQxMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxIUFxcXFxEb2N1bWVudHNcXFxcSW5mVGVjaC1xdWl6LW1hbmFnZW1lbnQtc3lzdGVtXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXHJlcG9ydHNcXFxcYWNhZGVtaWMtaW50ZWdyaXR5XFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9yZXBvcnRzL2FjYWRlbWljLWludGVncml0eS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3JlcG9ydHMvYWNhZGVtaWMtaW50ZWdyaXR5XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9yZXBvcnRzL2FjYWRlbWljLWludGVncml0eS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXEhQXFxcXERvY3VtZW50c1xcXFxJbmZUZWNoLXF1aXotbWFuYWdlbWVudC1zeXN0ZW1cXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccmVwb3J0c1xcXFxhY2FkZW1pYy1pbnRlZ3JpdHlcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3JlcG9ydHMvYWNhZGVtaWMtaW50ZWdyaXR5L3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Freports%2Facademic-integrity%2Froute&page=%2Fapi%2Freports%2Facademic-integrity%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Freports%2Facademic-integrity%2Froute.ts&appDir=C%3A%5CUsers%5CHP%5CDocuments%5CInfTech-quiz-management-system%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CHP%5CDocuments%5CInfTech-quiz-management-system&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/reports/academic-integrity/route.ts":
/*!*********************************************************!*\
  !*** ./src/app/api/reports/academic-integrity/route.ts ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n\n\n\n// GET /api/reports/academic-integrity - Generate comprehensive integrity report\nasync function GET(request) {\n    try {\n        const session = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.requireRole)(\"ADMIN\");\n        const { searchParams } = new URL(request.url);\n        const quizId = searchParams.get(\"quizId\");\n        const timeRange = parseInt(searchParams.get(\"timeRange\") || \"30\") // days\n        ;\n        const userId = searchParams.get(\"userId\");\n        const startDate = new Date();\n        startDate.setDate(startDate.getDate() - timeRange);\n        // Base query conditions\n        const whereConditions = {\n            timestamp: {\n                gte: startDate\n            }\n        };\n        if (userId) {\n            whereConditions.userId = userId;\n        }\n        if (quizId) {\n            // Get room IDs associated with the quiz\n            const quizRooms = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.chatRoom.findMany({\n                where: {\n                    quizId\n                },\n                select: {\n                    id: true\n                }\n            });\n            whereConditions.roomId = {\n                in: quizRooms.map((room)=>room.id)\n            };\n        }\n        // Fetch suspicious activities\n        const suspiciousActivities = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.suspiciousActivity.findMany({\n            where: whereConditions,\n            include: {\n                user: {\n                    select: {\n                        id: true,\n                        name: true,\n                        email: true,\n                        role: true\n                    }\n                },\n                room: {\n                    select: {\n                        id: true,\n                        name: true,\n                        type: true,\n                        quiz: {\n                            select: {\n                                id: true,\n                                title: true\n                            }\n                        }\n                    }\n                },\n                message: {\n                    select: {\n                        id: true,\n                        content: true,\n                        createdAt: true\n                    }\n                }\n            },\n            orderBy: {\n                timestamp: \"desc\"\n            }\n        });\n        // Analyze patterns across multiple quizzes\n        const patternAnalysis = await analyzeViolationPatterns(whereConditions);\n        // Generate risk assessment for users\n        const userRiskAssessment = await generateUserRiskAssessment(whereConditions);\n        // Quiz-specific analysis\n        const quizAnalysis = quizId ? await analyzeQuizIntegrity(quizId) : null;\n        // Generate recommendations\n        const recommendations = generateRecommendations(suspiciousActivities, patternAnalysis);\n        // Create summary statistics\n        const summary = {\n            totalViolations: suspiciousActivities.length,\n            highSeverityViolations: suspiciousActivities.filter((a)=>a.severity === \"HIGH\").length,\n            mediumSeverityViolations: suspiciousActivities.filter((a)=>a.severity === \"MEDIUM\").length,\n            lowSeverityViolations: suspiciousActivities.filter((a)=>a.severity === \"LOW\").length,\n            resolvedViolations: suspiciousActivities.filter((a)=>a.resolved).length,\n            uniqueUsers: new Set(suspiciousActivities.map((a)=>a.userId)).size,\n            uniqueQuizzes: new Set(suspiciousActivities.map((a)=>a.room.quiz?.id).filter(Boolean)).size,\n            timeRange: timeRange\n        };\n        // Generate overall integrity score\n        const integrityScore = calculateIntegrityScore(summary, patternAnalysis);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            summary,\n            integrityScore,\n            suspiciousActivities: suspiciousActivities.map((activity)=>({\n                    id: activity.id,\n                    type: activity.type,\n                    severity: activity.severity,\n                    description: activity.description,\n                    evidence: activity.evidence ? JSON.parse(activity.evidence) : null,\n                    timestamp: activity.timestamp,\n                    resolved: activity.resolved,\n                    user: activity.user,\n                    room: activity.room,\n                    message: activity.message\n                })),\n            patternAnalysis,\n            userRiskAssessment,\n            quizAnalysis,\n            recommendations\n        });\n    } catch (error) {\n        console.error(\"Error generating integrity report:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function analyzeViolationPatterns(whereConditions) {\n    // Analyze patterns by type\n    const violationsByType = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.suspiciousActivity.groupBy({\n        by: [\n            \"type\"\n        ],\n        where: whereConditions,\n        _count: {\n            id: true\n        }\n    });\n    // Analyze patterns by time (hourly distribution)\n    const violationsByHour = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.suspiciousActivity.findMany({\n        where: whereConditions,\n        select: {\n            timestamp: true,\n            severity: true\n        }\n    });\n    const hourlyDistribution = violationsByHour.reduce((acc, violation)=>{\n        const hour = new Date(violation.timestamp).getHours();\n        if (!acc[hour]) {\n            acc[hour] = {\n                total: 0,\n                high: 0,\n                medium: 0,\n                low: 0\n            };\n        }\n        acc[hour].total++;\n        acc[hour][violation.severity?.toLowerCase()] = (acc[hour][violation.severity?.toLowerCase()] || 0) + 1;\n        return acc;\n    }, {});\n    // Analyze repeat offenders\n    const repeatOffenders = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.suspiciousActivity.groupBy({\n        by: [\n            \"userId\"\n        ],\n        where: whereConditions,\n        _count: {\n            id: true\n        },\n        having: {\n            id: {\n                _count: {\n                    gt: 3\n                }\n            }\n        }\n    });\n    // Get user details for repeat offenders\n    const offenderDetails = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.user.findMany({\n        where: {\n            id: {\n                in: repeatOffenders.map((offender)=>offender.userId)\n            }\n        },\n        select: {\n            id: true,\n            name: true,\n            email: true,\n            role: true\n        }\n    });\n    return {\n        violationsByType: violationsByType.map((item)=>({\n                type: item.type,\n                count: item._count.id\n            })),\n        hourlyDistribution,\n        repeatOffenders: repeatOffenders.map((offender)=>({\n                ...offender,\n                user: offenderDetails.find((user)=>user.id === offender.userId),\n                violationCount: offender._count.id\n            }))\n    };\n}\nasync function generateUserRiskAssessment(whereConditions) {\n    const userViolations = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.suspiciousActivity.groupBy({\n        by: [\n            \"userId\",\n            \"severity\"\n        ],\n        where: whereConditions,\n        _count: {\n            id: true\n        }\n    });\n    // Calculate risk scores for each user\n    const userRiskScores = userViolations.reduce((acc, violation)=>{\n        if (!acc[violation.userId]) {\n            acc[violation.userId] = {\n                high: 0,\n                medium: 0,\n                low: 0,\n                total: 0\n            };\n        }\n        const severity = violation.severity?.toLowerCase();\n        acc[violation.userId][severity] += violation._count.id;\n        acc[violation.userId].total += violation._count.id;\n        return acc;\n    }, {});\n    // Get user details and calculate final risk scores\n    const userIds = Object.keys(userRiskScores);\n    const users = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.user.findMany({\n        where: {\n            id: {\n                in: userIds\n            }\n        },\n        select: {\n            id: true,\n            name: true,\n            email: true,\n            role: true\n        }\n    });\n    return users.map((user)=>{\n        const violations = userRiskScores[user.id];\n        const riskScore = (violations.high * 3 + violations.medium * 2 + violations.low * 1) / violations.total;\n        let riskLevel;\n        if (riskScore >= 2.5 || violations.high >= 3) riskLevel = \"HIGH\";\n        else if (riskScore >= 1.5 || violations.medium >= 5) riskLevel = \"MEDIUM\";\n        else riskLevel = \"LOW\";\n        return {\n            user,\n            violations,\n            riskScore: Math.round(riskScore * 100) / 100,\n            riskLevel\n        };\n    }).sort((a, b)=>b.riskScore - a.riskScore);\n}\nasync function analyzeQuizIntegrity(quizId) {\n    const quiz = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.quiz.findUnique({\n        where: {\n            id: quizId\n        },\n        include: {\n            chatRooms: {\n                include: {\n                    suspiciousActivities: {\n                        include: {\n                            user: {\n                                select: {\n                                    id: true,\n                                    name: true,\n                                    email: true\n                                }\n                            }\n                        }\n                    }\n                }\n            },\n            attempts: {\n                include: {\n                    user: {\n                        select: {\n                            id: true,\n                            name: true,\n                            email: true\n                        }\n                    }\n                }\n            }\n        }\n    });\n    if (!quiz) return null;\n    const violations = quiz.chatRooms.flatMap((room)=>room.suspiciousActivities);\n    const attemptUsers = quiz.attempts.map((attempt)=>attempt.user.id);\n    const violationUsers = violations.map((violation)=>violation.userId);\n    // Users who had violations and took the quiz\n    const compromisedAttempts = attemptUsers.filter((userId)=>violationUsers.includes(userId));\n    return {\n        quizTitle: quiz.title,\n        totalAttempts: quiz.attempts.length,\n        totalViolations: violations.length,\n        compromisedAttempts: compromisedAttempts.length,\n        integrityScore: Math.max(0, 100 - compromisedAttempts.length / quiz.attempts.length * 100),\n        violationsByType: violations.reduce((acc, violation)=>{\n            acc[violation.type] = (acc[violation.type] || 0) + 1;\n            return acc;\n        }, {})\n    };\n}\nfunction generateRecommendations(activities, patterns) {\n    const recommendations = [];\n    // High severity violations\n    const highSeverityCount = activities.filter((a)=>a.severity === \"HIGH\").length;\n    if (highSeverityCount > 5) {\n        recommendations.push(\"Immediate review required: High number of severe violations detected\");\n        recommendations.push(\"Consider implementing stricter chat monitoring during quiz periods\");\n    }\n    // Repeat offenders\n    if (patterns.repeatOffenders.length > 0) {\n        recommendations.push(`Monitor ${patterns.repeatOffenders.length} repeat offenders closely`);\n        recommendations.push(\"Consider individual meetings with students showing repeated violations\");\n    }\n    // Time-based patterns\n    const peakViolationHour = Object.entries(patterns.hourlyDistribution).sort(([, a], [, b])=>b.total - a.total)[0];\n    if (peakViolationHour && peakViolationHour[1].total > 5) {\n        recommendations.push(`Increase monitoring during ${peakViolationHour[0]}:00 - peak violation time`);\n    }\n    // Violation types\n    const keywordViolations = patterns.violationsByType.find((v)=>v.type === \"KEYWORD_MATCH\");\n    if (keywordViolations && keywordViolations.count > 10) {\n        recommendations.push(\"Review and update suspicious keyword detection rules\");\n        recommendations.push(\"Provide clearer guidelines on acceptable chat behavior during quizzes\");\n    }\n    const timingViolations = patterns.violationsByType.find((v)=>v.type === \"TIMING_VIOLATION\");\n    if (timingViolations && timingViolations.count > 5) {\n        recommendations.push(\"Enforce stricter chat restrictions during active quiz periods\");\n        recommendations.push(\"Consider disabling chat completely during quiz attempts\");\n    }\n    // General recommendations\n    if (activities.length > 20) {\n        recommendations.push(\"Conduct academic integrity workshop for students\");\n        recommendations.push(\"Review quiz security measures and chat policies\");\n    }\n    return recommendations;\n}\nfunction calculateIntegrityScore(summary, patterns) {\n    let score = 100;\n    // Deduct points based on violations\n    score -= summary.highSeverityViolations * 5;\n    score -= summary.mediumSeverityViolations * 2;\n    score -= summary.lowSeverityViolations * 0.5;\n    // Deduct points for repeat offenders\n    score -= patterns.repeatOffenders.length * 3;\n    // Ensure score doesn't go below 0\n    score = Math.max(0, Math.round(score));\n    let level;\n    let description;\n    if (score >= 90) {\n        level = \"EXCELLENT\";\n        description = \"Very high academic integrity with minimal violations\";\n    } else if (score >= 75) {\n        level = \"GOOD\";\n        description = \"Good academic integrity with some minor concerns\";\n    } else if (score >= 60) {\n        level = \"FAIR\";\n        description = \"Moderate integrity concerns requiring attention\";\n    } else if (score >= 40) {\n        level = \"POOR\";\n        description = \"Significant integrity issues requiring immediate action\";\n    } else {\n        level = \"CRITICAL\";\n        description = \"Critical integrity violations requiring urgent intervention\";\n    }\n    return {\n        score,\n        level,\n        description\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9yZXBvcnRzL2FjYWRlbWljLWludGVncml0eS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXVEO0FBQ2xCO0FBQ0c7QUFHeEMsZ0ZBQWdGO0FBQ3pFLGVBQWVHLElBQUlDLE9BQW9CO0lBQzVDLElBQUk7UUFDRixNQUFNQyxVQUFVLE1BQU1ILHNEQUFXQSxDQUFDO1FBQ2xDLE1BQU0sRUFBRUksWUFBWSxFQUFFLEdBQUcsSUFBSUMsSUFBSUgsUUFBUUksR0FBRztRQUU1QyxNQUFNQyxTQUFTSCxhQUFhSSxHQUFHLENBQUM7UUFDaEMsTUFBTUMsWUFBWUMsU0FBU04sYUFBYUksR0FBRyxDQUFDLGdCQUFnQixNQUFNLE9BQU87O1FBQ3pFLE1BQU1HLFNBQVNQLGFBQWFJLEdBQUcsQ0FBQztRQUVoQyxNQUFNSSxZQUFZLElBQUlDO1FBQ3RCRCxVQUFVRSxPQUFPLENBQUNGLFVBQVVHLE9BQU8sS0FBS047UUFFeEMsd0JBQXdCO1FBQ3hCLE1BQU1PLGtCQUF1QjtZQUMzQkMsV0FBVztnQkFDVEMsS0FBS047WUFDUDtRQUNGO1FBRUEsSUFBSUQsUUFBUTtZQUNWSyxnQkFBZ0JMLE1BQU0sR0FBR0E7UUFDM0I7UUFFQSxJQUFJSixRQUFRO1lBQ1Ysd0NBQXdDO1lBQ3hDLE1BQU1ZLFlBQVksTUFBTXBCLCtDQUFNQSxDQUFDcUIsUUFBUSxDQUFDQyxRQUFRLENBQUM7Z0JBQy9DQyxPQUFPO29CQUFFZjtnQkFBTztnQkFDaEJnQixRQUFRO29CQUFFQyxJQUFJO2dCQUFLO1lBQ3JCO1lBQ0FSLGdCQUFnQlMsTUFBTSxHQUFHO2dCQUN2QkMsSUFBSVAsVUFBVVEsR0FBRyxDQUFDQyxDQUFBQSxPQUFRQSxLQUFLSixFQUFFO1lBQ25DO1FBQ0Y7UUFFQSw4QkFBOEI7UUFDOUIsTUFBTUssdUJBQXVCLE1BQU05QiwrQ0FBTUEsQ0FBQytCLGtCQUFrQixDQUFDVCxRQUFRLENBQUM7WUFDcEVDLE9BQU9OO1lBQ1BlLFNBQVM7Z0JBQ1BD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UUFBUTtRQUNSbkUsY0FBYztJQUNoQixPQUFPLElBQUlrRSxTQUFTLElBQUk7UUFDdEJDLFFBQVE7UUFDUm5FLGNBQWM7SUFDaEIsT0FBTyxJQUFJa0UsU0FBUyxJQUFJO1FBQ3RCQyxRQUFRO1FBQ1JuRSxjQUFjO0lBQ2hCLE9BQU8sSUFBSWtFLFNBQVMsSUFBSTtRQUN0QkMsUUFBUTtRQUNSbkUsY0FBYztJQUNoQixPQUFPO1FBQ0xtRSxRQUFRO1FBQ1JuRSxjQUFjO0lBQ2hCO0lBRUEsT0FBTztRQUFFa0U7UUFBT0M7UUFBT25FO0lBQVk7QUFDckMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9xdWl6LW1hbmFnZW1lbnQtc3lzdGVtLy4vc3JjL2FwcC9hcGkvcmVwb3J0cy9hY2FkZW1pYy1pbnRlZ3JpdHkvcm91dGUudHM/YjY4NiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAL2xpYi9wcmlzbWEnXG5pbXBvcnQgeyByZXF1aXJlUm9sZSB9IGZyb20gJ0AvbGliL2F1dGgnXG5pbXBvcnQgeyBnZW5lcmF0ZUludGVncml0eVJlcG9ydCB9IGZyb20gJ0AvbGliL2FjYWRlbWljLWludGVncml0eSdcblxuLy8gR0VUIC9hcGkvcmVwb3J0cy9hY2FkZW1pYy1pbnRlZ3JpdHkgLSBHZW5lcmF0ZSBjb21wcmVoZW5zaXZlIGludGVncml0eSByZXBvcnRcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgcmVxdWlyZVJvbGUoJ0FETUlOJylcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybClcbiAgICBcbiAgICBjb25zdCBxdWl6SWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCdxdWl6SWQnKVxuICAgIGNvbnN0IHRpbWVSYW5nZSA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ3RpbWVSYW5nZScpIHx8ICczMCcpIC8vIGRheXNcbiAgICBjb25zdCB1c2VySWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCd1c2VySWQnKVxuICAgIFxuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKClcbiAgICBzdGFydERhdGUuc2V0RGF0ZShzdGFydERhdGUuZ2V0RGF0ZSgpIC0gdGltZVJhbmdlKVxuXG4gICAgLy8gQmFzZSBxdWVyeSBjb25kaXRpb25zXG4gICAgY29uc3Qgd2hlcmVDb25kaXRpb25zOiBhbnkgPSB7XG4gICAgICB0aW1lc3RhbXA6IHtcbiAgICAgICAgZ3RlOiBzdGFydERhdGVcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodXNlcklkKSB7XG4gICAgICB3aGVyZUNvbmRpdGlvbnMudXNlcklkID0gdXNlcklkXG4gICAgfVxuXG4gICAgaWYgKHF1aXpJZCkge1xuICAgICAgLy8gR2V0IHJvb20gSURzIGFzc29jaWF0ZWQgd2l0aCB0aGUgcXVpelxuICAgICAgY29uc3QgcXVpelJvb21zID0gYXdhaXQgcHJpc21hLmNoYXRSb29tLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgcXVpeklkIH0sXG4gICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSB9XG4gICAgICB9KVxuICAgICAgd2hlcmVDb25kaXRpb25zLnJvb21JZCA9IHtcbiAgICAgICAgaW46IHF1aXpSb29tcy5tYXAocm9vbSA9PiByb29tLmlkKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZldGNoIHN1c3BpY2lvdXMgYWN0aXZpdGllc1xuICAgIGNvbnN0IHN1c3BpY2lvdXNBY3Rpdml0aWVzID0gYXdhaXQgcHJpc21hLnN1c3BpY2lvdXNBY3Rpdml0eS5maW5kTWFueSh7XG4gICAgICB3aGVyZTogd2hlcmVDb25kaXRpb25zLFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgIHJvbGU6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJvb206IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIHR5cGU6IHRydWUsXG4gICAgICAgICAgICBxdWl6OiB7XG4gICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB0cnVlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG1lc3NhZ2U6IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgY29udGVudDogdHJ1ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG9yZGVyQnk6IHsgdGltZXN0YW1wOiAnZGVzYycgfVxuICAgIH0pXG5cbiAgICAvLyBBbmFseXplIHBhdHRlcm5zIGFjcm9zcyBtdWx0aXBsZSBxdWl6emVzXG4gICAgY29uc3QgcGF0dGVybkFuYWx5c2lzID0gYXdhaXQgYW5hbHl6ZVZpb2xhdGlvblBhdHRlcm5zKHdoZXJlQ29uZGl0aW9ucylcbiAgICBcbiAgICAvLyBHZW5lcmF0ZSByaXNrIGFzc2Vzc21lbnQgZm9yIHVzZXJzXG4gICAgY29uc3QgdXNlclJpc2tBc3Nlc3NtZW50ID0gYXdhaXQgZ2VuZXJhdGVVc2VyUmlza0Fzc2Vzc21lbnQod2hlcmVDb25kaXRpb25zKVxuICAgIFxuICAgIC8vIFF1aXotc3BlY2lmaWMgYW5hbHlzaXNcbiAgICBjb25zdCBxdWl6QW5hbHlzaXMgPSBxdWl6SWQgPyBhd2FpdCBhbmFseXplUXVpekludGVncml0eShxdWl6SWQpIDogbnVsbFxuICAgIFxuICAgIC8vIEdlbmVyYXRlIHJlY29tbWVuZGF0aW9uc1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IGdlbmVyYXRlUmVjb21tZW5kYXRpb25zKHN1c3BpY2lvdXNBY3Rpdml0aWVzLCBwYXR0ZXJuQW5hbHlzaXMpXG4gICAgXG4gICAgLy8gQ3JlYXRlIHN1bW1hcnkgc3RhdGlzdGljc1xuICAgIGNvbnN0IHN1bW1hcnkgPSB7XG4gICAgICB0b3RhbFZpb2xhdGlvbnM6IHN1c3BpY2lvdXNBY3Rpdml0aWVzLmxlbmd0aCxcbiAgICAgIGhpZ2hTZXZlcml0eVZpb2xhdGlvbnM6IHN1c3BpY2lvdXNBY3Rpdml0aWVzLmZpbHRlcihhID0+IGEuc2V2ZXJpdHkgPT09ICdISUdIJykubGVuZ3RoLFxuICAgICAgbWVkaXVtU2V2ZXJpdHlWaW9sYXRpb25zOiBzdXNwaWNpb3VzQWN0aXZpdGllcy5maWx0ZXIoYSA9PiBhLnNldmVyaXR5ID09PSAnTUVESVVNJykubGVuZ3RoLFxuICAgICAgbG93U2V2ZXJpdHlWaW9sYXRpb25zOiBzdXNwaWNpb3VzQWN0aXZpdGllcy5maWx0ZXIoYSA9PiBhLnNldmVyaXR5ID09PSAnTE9XJykubGVuZ3RoLFxuICAgICAgcmVzb2x2ZWRWaW9sYXRpb25zOiBzdXNwaWNpb3VzQWN0aXZpdGllcy5maWx0ZXIoYSA9PiBhLnJlc29sdmVkKS5sZW5ndGgsXG4gICAgICB1bmlxdWVVc2VyczogbmV3IFNldChzdXNwaWNpb3VzQWN0aXZpdGllcy5tYXAoYSA9PiBhLnVzZXJJZCkpLnNpemUsXG4gICAgICB1bmlxdWVRdWl6emVzOiBuZXcgU2V0KHN1c3BpY2lvdXNBY3Rpdml0aWVzLm1hcChhID0+IGEucm9vbS5xdWl6Py5pZCkuZmlsdGVyKEJvb2xlYW4pKS5zaXplLFxuICAgICAgdGltZVJhbmdlOiB0aW1lUmFuZ2VcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBvdmVyYWxsIGludGVncml0eSBzY29yZVxuICAgIGNvbnN0IGludGVncml0eVNjb3JlID0gY2FsY3VsYXRlSW50ZWdyaXR5U2NvcmUoc3VtbWFyeSwgcGF0dGVybkFuYWx5c2lzKVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1bW1hcnksXG4gICAgICBpbnRlZ3JpdHlTY29yZSxcbiAgICAgIHN1c3BpY2lvdXNBY3Rpdml0aWVzOiBzdXNwaWNpb3VzQWN0aXZpdGllcy5tYXAoYWN0aXZpdHkgPT4gKHtcbiAgICAgICAgaWQ6IGFjdGl2aXR5LmlkLFxuICAgICAgICB0eXBlOiBhY3Rpdml0eS50eXBlLFxuICAgICAgICBzZXZlcml0eTogYWN0aXZpdHkuc2V2ZXJpdHksXG4gICAgICAgIGRlc2NyaXB0aW9uOiBhY3Rpdml0eS5kZXNjcmlwdGlvbixcbiAgICAgICAgZXZpZGVuY2U6IGFjdGl2aXR5LmV2aWRlbmNlID8gSlNPTi5wYXJzZShhY3Rpdml0eS5ldmlkZW5jZSkgOiBudWxsLFxuICAgICAgICB0aW1lc3RhbXA6IGFjdGl2aXR5LnRpbWVzdGFtcCxcbiAgICAgICAgcmVzb2x2ZWQ6IGFjdGl2aXR5LnJlc29sdmVkLFxuICAgICAgICB1c2VyOiBhY3Rpdml0eS51c2VyLFxuICAgICAgICByb29tOiBhY3Rpdml0eS5yb29tLFxuICAgICAgICBtZXNzYWdlOiBhY3Rpdml0eS5tZXNzYWdlXG4gICAgICB9KSksXG4gICAgICBwYXR0ZXJuQW5hbHlzaXMsXG4gICAgICB1c2VyUmlza0Fzc2Vzc21lbnQsXG4gICAgICBxdWl6QW5hbHlzaXMsXG4gICAgICByZWNvbW1lbmRhdGlvbnNcbiAgICB9KVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdlbmVyYXRpbmcgaW50ZWdyaXR5IHJlcG9ydDonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgfSwgeyBzdGF0dXM6IDUwMCB9KVxuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFuYWx5emVWaW9sYXRpb25QYXR0ZXJucyh3aGVyZUNvbmRpdGlvbnM6IGFueSkge1xuICAvLyBBbmFseXplIHBhdHRlcm5zIGJ5IHR5cGVcbiAgY29uc3QgdmlvbGF0aW9uc0J5VHlwZSA9IGF3YWl0IHByaXNtYS5zdXNwaWNpb3VzQWN0aXZpdHkuZ3JvdXBCeSh7XG4gICAgYnk6IFsndHlwZSddLFxuICAgIHdoZXJlOiB3aGVyZUNvbmRpdGlvbnMsXG4gICAgX2NvdW50OiB7XG4gICAgICBpZDogdHJ1ZVxuICAgIH1cbiAgfSlcblxuICAvLyBBbmFseXplIHBhdHRlcm5zIGJ5IHRpbWUgKGhvdXJseSBkaXN0cmlidXRpb24pXG4gIGNvbnN0IHZpb2xhdGlvbnNCeUhvdXIgPSBhd2FpdCBwcmlzbWEuc3VzcGljaW91c0FjdGl2aXR5LmZpbmRNYW55KHtcbiAgICB3aGVyZTogd2hlcmVDb25kaXRpb25zLFxuICAgIHNlbGVjdDoge1xuICAgICAgdGltZXN0YW1wOiB0cnVlLFxuICAgICAgc2V2ZXJpdHk6IHRydWVcbiAgICB9XG4gIH0pXG5cbiAgY29uc3QgaG91cmx5RGlzdHJpYnV0aW9uID0gdmlvbGF0aW9uc0J5SG91ci5yZWR1Y2UoKGFjYywgdmlvbGF0aW9uKSA9PiB7XG4gICAgY29uc3QgaG91ciA9IG5ldyBEYXRlKHZpb2xhdGlvbi50aW1lc3RhbXApLmdldEhvdXJzKClcbiAgICBpZiAoIWFjY1tob3VyXSkge1xuICAgICAgYWNjW2hvdXJdID0geyB0b3RhbDogMCwgaGlnaDogMCwgbWVkaXVtOiAwLCBsb3c6IDAgfVxuICAgIH1cbiAgICBhY2NbaG91cl0udG90YWwrK1xuICAgIGFjY1tob3VyXVt2aW9sYXRpb24uc2V2ZXJpdHk/LnRvTG93ZXJDYXNlKCkgYXMga2V5b2YgdHlwZW9mIGFjY1swXV0gPSBcbiAgICAgIChhY2NbaG91cl1bdmlvbGF0aW9uLnNldmVyaXR5Py50b0xvd2VyQ2FzZSgpIGFzIGtleW9mIHR5cGVvZiBhY2NbMF1dIHx8IDApICsgMVxuICAgIHJldHVybiBhY2NcbiAgfSwge30gYXMgUmVjb3JkPG51bWJlciwgeyB0b3RhbDogbnVtYmVyLCBoaWdoOiBudW1iZXIsIG1lZGl1bTogbnVtYmVyLCBsb3c6IG51bWJlciB9PilcblxuICAvLyBBbmFseXplIHJlcGVhdCBvZmZlbmRlcnNcbiAgY29uc3QgcmVwZWF0T2ZmZW5kZXJzID0gYXdhaXQgcHJpc21hLnN1c3BpY2lvdXNBY3Rpdml0eS5ncm91cEJ5KHtcbiAgICBieTogWyd1c2VySWQnXSxcbiAgICB3aGVyZTogd2hlcmVDb25kaXRpb25zLFxuICAgIF9jb3VudDoge1xuICAgICAgaWQ6IHRydWVcbiAgICB9LFxuICAgIGhhdmluZzoge1xuICAgICAgaWQ6IHtcbiAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgZ3Q6IDNcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSlcblxuICAvLyBHZXQgdXNlciBkZXRhaWxzIGZvciByZXBlYXQgb2ZmZW5kZXJzXG4gIGNvbnN0IG9mZmVuZGVyRGV0YWlscyA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHtcbiAgICAgICAgaW46IHJlcGVhdE9mZmVuZGVycy5tYXAob2ZmZW5kZXIgPT4gb2ZmZW5kZXIudXNlcklkKVxuICAgICAgfVxuICAgIH0sXG4gICAgc2VsZWN0OiB7XG4gICAgICBpZDogdHJ1ZSxcbiAgICAgIG5hbWU6IHRydWUsXG4gICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgIHJvbGU6IHRydWVcbiAgICB9XG4gIH0pXG5cbiAgcmV0dXJuIHtcbiAgICB2aW9sYXRpb25zQnlUeXBlOiB2aW9sYXRpb25zQnlUeXBlLm1hcChpdGVtID0+ICh7XG4gICAgICB0eXBlOiBpdGVtLnR5cGUsXG4gICAgICBjb3VudDogaXRlbS5fY291bnQuaWRcbiAgICB9KSksXG4gICAgaG91cmx5RGlzdHJpYnV0aW9uLFxuICAgIHJlcGVhdE9mZmVuZGVyczogcmVwZWF0T2ZmZW5kZXJzLm1hcChvZmZlbmRlciA9PiAoe1xuICAgICAgLi4ub2ZmZW5kZXIsXG4gICAgICB1c2VyOiBvZmZlbmRlckRldGFpbHMuZmluZCh1c2VyID0+IHVzZXIuaWQgPT09IG9mZmVuZGVyLnVzZXJJZCksXG4gICAgICB2aW9sYXRpb25Db3VudDogb2ZmZW5kZXIuX2NvdW50LmlkXG4gICAgfSkpXG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVVc2VyUmlza0Fzc2Vzc21lbnQod2hlcmVDb25kaXRpb25zOiBhbnkpIHtcbiAgY29uc3QgdXNlclZpb2xhdGlvbnMgPSBhd2FpdCBwcmlzbWEuc3VzcGljaW91c0FjdGl2aXR5Lmdyb3VwQnkoe1xuICAgIGJ5OiBbJ3VzZXJJZCcsICdzZXZlcml0eSddLFxuICAgIHdoZXJlOiB3aGVyZUNvbmRpdGlvbnMsXG4gICAgX2NvdW50OiB7XG4gICAgICBpZDogdHJ1ZVxuICAgIH1cbiAgfSlcblxuICAvLyBDYWxjdWxhdGUgcmlzayBzY29yZXMgZm9yIGVhY2ggdXNlclxuICBjb25zdCB1c2VyUmlza1Njb3JlcyA9IHVzZXJWaW9sYXRpb25zLnJlZHVjZSgoYWNjLCB2aW9sYXRpb24pID0+IHtcbiAgICBpZiAoIWFjY1t2aW9sYXRpb24udXNlcklkXSkge1xuICAgICAgYWNjW3Zpb2xhdGlvbi51c2VySWRdID0geyBoaWdoOiAwLCBtZWRpdW06IDAsIGxvdzogMCwgdG90YWw6IDAgfVxuICAgIH1cbiAgICBcbiAgICBjb25zdCBzZXZlcml0eSA9IHZpb2xhdGlvbi5zZXZlcml0eT8udG9Mb3dlckNhc2UoKSBhcyAnaGlnaCcgfCAnbWVkaXVtJyB8ICdsb3cnXG4gICAgYWNjW3Zpb2xhdGlvbi51c2VySWRdW3NldmVyaXR5XSArPSB2aW9sYXRpb24uX2NvdW50LmlkXG4gICAgYWNjW3Zpb2xhdGlvbi51c2VySWRdLnRvdGFsICs9IHZpb2xhdGlvbi5fY291bnQuaWRcbiAgICBcbiAgICByZXR1cm4gYWNjXG4gIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIHsgaGlnaDogbnVtYmVyLCBtZWRpdW06IG51bWJlciwgbG93OiBudW1iZXIsIHRvdGFsOiBudW1iZXIgfT4pXG5cbiAgLy8gR2V0IHVzZXIgZGV0YWlscyBhbmQgY2FsY3VsYXRlIGZpbmFsIHJpc2sgc2NvcmVzXG4gIGNvbnN0IHVzZXJJZHMgPSBPYmplY3Qua2V5cyh1c2VyUmlza1Njb3JlcylcbiAgY29uc3QgdXNlcnMgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kTWFueSh7XG4gICAgd2hlcmU6IHsgaWQ6IHsgaW46IHVzZXJJZHMgfSB9LFxuICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgbmFtZTogdHJ1ZSwgZW1haWw6IHRydWUsIHJvbGU6IHRydWUgfVxuICB9KVxuXG4gIHJldHVybiB1c2Vycy5tYXAodXNlciA9PiB7XG4gICAgY29uc3QgdmlvbGF0aW9ucyA9IHVzZXJSaXNrU2NvcmVzW3VzZXIuaWRdXG4gICAgY29uc3Qgcmlza1Njb3JlID0gKHZpb2xhdGlvbnMuaGlnaCAqIDMgKyB2aW9sYXRpb25zLm1lZGl1bSAqIDIgKyB2aW9sYXRpb25zLmxvdyAqIDEpIC8gdmlvbGF0aW9ucy50b3RhbFxuICAgIFxuICAgIGxldCByaXNrTGV2ZWw6ICdMT1cnIHwgJ01FRElVTScgfCAnSElHSCdcbiAgICBpZiAocmlza1Njb3JlID49IDIuNSB8fCB2aW9sYXRpb25zLmhpZ2ggPj0gMykgcmlza0xldmVsID0gJ0hJR0gnXG4gICAgZWxzZSBpZiAocmlza1Njb3JlID49IDEuNSB8fCB2aW9sYXRpb25zLm1lZGl1bSA+PSA1KSByaXNrTGV2ZWwgPSAnTUVESVVNJ1xuICAgIGVsc2Ugcmlza0xldmVsID0gJ0xPVydcblxuICAgIHJldHVybiB7XG4gICAgICB1c2VyLFxuICAgICAgdmlvbGF0aW9ucyxcbiAgICAgIHJpc2tTY29yZTogTWF0aC5yb3VuZChyaXNrU2NvcmUgKiAxMDApIC8gMTAwLFxuICAgICAgcmlza0xldmVsXG4gICAgfVxuICB9KS5zb3J0KChhLCBiKSA9PiBiLnJpc2tTY29yZSAtIGEucmlza1Njb3JlKVxufVxuXG5hc3luYyBmdW5jdGlvbiBhbmFseXplUXVpekludGVncml0eShxdWl6SWQ6IHN0cmluZykge1xuICBjb25zdCBxdWl6ID0gYXdhaXQgcHJpc21hLnF1aXouZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHsgaWQ6IHF1aXpJZCB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIGNoYXRSb29tczoge1xuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgc3VzcGljaW91c0FjdGl2aXRpZXM6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgbmFtZTogdHJ1ZSwgZW1haWw6IHRydWUgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYXR0ZW1wdHM6IHtcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgbmFtZTogdHJ1ZSwgZW1haWw6IHRydWUgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSlcblxuICBpZiAoIXF1aXopIHJldHVybiBudWxsXG5cbiAgY29uc3QgdmlvbGF0aW9ucyA9IHF1aXouY2hhdFJvb21zLmZsYXRNYXAocm9vbSA9PiByb29tLnN1c3BpY2lvdXNBY3Rpdml0aWVzKVxuICBjb25zdCBhdHRlbXB0VXNlcnMgPSBxdWl6LmF0dGVtcHRzLm1hcChhdHRlbXB0ID0+IGF0dGVtcHQudXNlci5pZClcbiAgY29uc3QgdmlvbGF0aW9uVXNlcnMgPSB2aW9sYXRpb25zLm1hcCh2aW9sYXRpb24gPT4gdmlvbGF0aW9uLnVzZXJJZClcbiAgXG4gIC8vIFVzZXJzIHdobyBoYWQgdmlvbGF0aW9ucyBhbmQgdG9vayB0aGUgcXVpelxuICBjb25zdCBjb21wcm9taXNlZEF0dGVtcHRzID0gYXR0ZW1wdFVzZXJzLmZpbHRlcih1c2VySWQgPT4gdmlvbGF0aW9uVXNlcnMuaW5jbHVkZXModXNlcklkKSlcbiAgXG4gIHJldHVybiB7XG4gICAgcXVpelRpdGxlOiBxdWl6LnRpdGxlLFxuICAgIHRvdGFsQXR0ZW1wdHM6IHF1aXouYXR0ZW1wdHMubGVuZ3RoLFxuICAgIHRvdGFsVmlvbGF0aW9uczogdmlvbGF0aW9ucy5sZW5ndGgsXG4gICAgY29tcHJvbWlzZWRBdHRlbXB0czogY29tcHJvbWlzZWRBdHRlbXB0cy5sZW5ndGgsXG4gICAgaW50ZWdyaXR5U2NvcmU6IE1hdGgubWF4KDAsIDEwMCAtIChjb21wcm9taXNlZEF0dGVtcHRzLmxlbmd0aCAvIHF1aXouYXR0ZW1wdHMubGVuZ3RoKSAqIDEwMCksXG4gICAgdmlvbGF0aW9uc0J5VHlwZTogdmlvbGF0aW9ucy5yZWR1Y2UoKGFjYywgdmlvbGF0aW9uKSA9PiB7XG4gICAgICBhY2NbdmlvbGF0aW9uLnR5cGVdID0gKGFjY1t2aW9sYXRpb24udHlwZV0gfHwgMCkgKyAxXG4gICAgICByZXR1cm4gYWNjXG4gICAgfSwge30gYXMgUmVjb3JkPHN0cmluZywgbnVtYmVyPilcbiAgfVxufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyhcbiAgYWN0aXZpdGllczogYW55W10sIFxuICBwYXR0ZXJuczogYW55XG4pOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXVxuXG4gIC8vIEhpZ2ggc2V2ZXJpdHkgdmlvbGF0aW9uc1xuICBjb25zdCBoaWdoU2V2ZXJpdHlDb3VudCA9IGFjdGl2aXRpZXMuZmlsdGVyKGEgPT4gYS5zZXZlcml0eSA9PT0gJ0hJR0gnKS5sZW5ndGhcbiAgaWYgKGhpZ2hTZXZlcml0eUNvdW50ID4gNSkge1xuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdJbW1lZGlhdGUgcmV2aWV3IHJlcXVpcmVkOiBIaWdoIG51bWJlciBvZiBzZXZlcmUgdmlvbGF0aW9ucyBkZXRlY3RlZCcpXG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0NvbnNpZGVyIGltcGxlbWVudGluZyBzdHJpY3RlciBjaGF0IG1vbml0b3JpbmcgZHVyaW5nIHF1aXogcGVyaW9kcycpXG4gIH1cblxuICAvLyBSZXBlYXQgb2ZmZW5kZXJzXG4gIGlmIChwYXR0ZXJucy5yZXBlYXRPZmZlbmRlcnMubGVuZ3RoID4gMCkge1xuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGBNb25pdG9yICR7cGF0dGVybnMucmVwZWF0T2ZmZW5kZXJzLmxlbmd0aH0gcmVwZWF0IG9mZmVuZGVycyBjbG9zZWx5YClcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQ29uc2lkZXIgaW5kaXZpZHVhbCBtZWV0aW5ncyB3aXRoIHN0dWRlbnRzIHNob3dpbmcgcmVwZWF0ZWQgdmlvbGF0aW9ucycpXG4gIH1cblxuICAvLyBUaW1lLWJhc2VkIHBhdHRlcm5zXG4gIGNvbnN0IHBlYWtWaW9sYXRpb25Ib3VyID0gT2JqZWN0LmVudHJpZXMocGF0dGVybnMuaG91cmx5RGlzdHJpYnV0aW9uKVxuICAgIC5zb3J0KChbLGFdLCBbLGJdKSA9PiAoYiBhcyBhbnkpLnRvdGFsIC0gKGEgYXMgYW55KS50b3RhbClbMF1cblxuICBpZiAocGVha1Zpb2xhdGlvbkhvdXIgJiYgKHBlYWtWaW9sYXRpb25Ib3VyWzFdIGFzIGFueSkudG90YWwgPiA1KSB7XG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goYEluY3JlYXNlIG1vbml0b3JpbmcgZHVyaW5nICR7cGVha1Zpb2xhdGlvbkhvdXJbMF19OjAwIC0gcGVhayB2aW9sYXRpb24gdGltZWApXG4gIH1cblxuICAvLyBWaW9sYXRpb24gdHlwZXNcbiAgY29uc3Qga2V5d29yZFZpb2xhdGlvbnMgPSBwYXR0ZXJucy52aW9sYXRpb25zQnlUeXBlLmZpbmQoKHY6IGFueSkgPT4gdi50eXBlID09PSAnS0VZV09SRF9NQVRDSCcpXG4gIGlmIChrZXl3b3JkVmlvbGF0aW9ucyAmJiBrZXl3b3JkVmlvbGF0aW9ucy5jb3VudCA+IDEwKSB7XG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ1JldmlldyBhbmQgdXBkYXRlIHN1c3BpY2lvdXMga2V5d29yZCBkZXRlY3Rpb24gcnVsZXMnKVxuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdQcm92aWRlIGNsZWFyZXIgZ3VpZGVsaW5lcyBvbiBhY2NlcHRhYmxlIGNoYXQgYmVoYXZpb3IgZHVyaW5nIHF1aXp6ZXMnKVxuICB9XG5cbiAgY29uc3QgdGltaW5nVmlvbGF0aW9ucyA9IHBhdHRlcm5zLnZpb2xhdGlvbnNCeVR5cGUuZmluZCgodjogYW55KSA9PiB2LnR5cGUgPT09ICdUSU1JTkdfVklPTEFUSU9OJylcbiAgaWYgKHRpbWluZ1Zpb2xhdGlvbnMgJiYgdGltaW5nVmlvbGF0aW9ucy5jb3VudCA+IDUpIHtcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnRW5mb3JjZSBzdHJpY3RlciBjaGF0IHJlc3RyaWN0aW9ucyBkdXJpbmcgYWN0aXZlIHF1aXogcGVyaW9kcycpXG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0NvbnNpZGVyIGRpc2FibGluZyBjaGF0IGNvbXBsZXRlbHkgZHVyaW5nIHF1aXogYXR0ZW1wdHMnKVxuICB9XG5cbiAgLy8gR2VuZXJhbCByZWNvbW1lbmRhdGlvbnNcbiAgaWYgKGFjdGl2aXRpZXMubGVuZ3RoID4gMjApIHtcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQ29uZHVjdCBhY2FkZW1pYyBpbnRlZ3JpdHkgd29ya3Nob3AgZm9yIHN0dWRlbnRzJylcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnUmV2aWV3IHF1aXogc2VjdXJpdHkgbWVhc3VyZXMgYW5kIGNoYXQgcG9saWNpZXMnKVxuICB9XG5cbiAgcmV0dXJuIHJlY29tbWVuZGF0aW9uc1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVJbnRlZ3JpdHlTY29yZShcbiAgc3VtbWFyeTogYW55LCBcbiAgcGF0dGVybnM6IGFueVxuKTogeyBzY29yZTogbnVtYmVyLCBsZXZlbDogc3RyaW5nLCBkZXNjcmlwdGlvbjogc3RyaW5nIH0ge1xuICBsZXQgc2NvcmUgPSAxMDBcblxuICAvLyBEZWR1Y3QgcG9pbnRzIGJhc2VkIG9uIHZpb2xhdGlvbnNcbiAgc2NvcmUgLT0gc3VtbWFyeS5oaWdoU2V2ZXJpdHlWaW9sYXRpb25zICogNVxuICBzY29yZSAtPSBzdW1tYXJ5Lm1lZGl1bVNldmVyaXR5VmlvbGF0aW9ucyAqIDJcbiAgc2NvcmUgLT0gc3VtbWFyeS5sb3dTZXZlcml0eVZpb2xhdGlvbnMgKiAwLjVcblxuICAvLyBEZWR1Y3QgcG9pbnRzIGZvciByZXBlYXQgb2ZmZW5kZXJzXG4gIHNjb3JlIC09IHBhdHRlcm5zLnJlcGVhdE9mZmVuZGVycy5sZW5ndGggKiAzXG5cbiAgLy8gRW5zdXJlIHNjb3JlIGRvZXNuJ3QgZ28gYmVsb3cgMFxuICBzY29yZSA9IE1hdGgubWF4KDAsIE1hdGgucm91bmQoc2NvcmUpKVxuXG4gIGxldCBsZXZlbDogc3RyaW5nXG4gIGxldCBkZXNjcmlwdGlvbjogc3RyaW5nXG5cbiAgaWYgKHNjb3JlID49IDkwKSB7XG4gICAgbGV2ZWwgPSAnRVhDRUxMRU5UJ1xuICAgIGRlc2NyaXB0aW9uID0gJ1ZlcnkgaGlnaCBhY2FkZW1pYyBpbnRlZ3JpdHkgd2l0aCBtaW5pbWFsIHZpb2xhdGlvbnMnXG4gIH0gZWxzZSBpZiAoc2NvcmUgPj0gNzUpIHtcbiAgICBsZXZlbCA9ICdHT09EJ1xuICAgIGRlc2NyaXB0aW9uID0gJ0dvb2QgYWNhZGVtaWMgaW50ZWdyaXR5IHdpdGggc29tZSBtaW5vciBjb25jZXJucydcbiAgfSBlbHNlIGlmIChzY29yZSA+PSA2MCkge1xuICAgIGxldmVsID0gJ0ZBSVInXG4gICAgZGVzY3JpcHRpb24gPSAnTW9kZXJhdGUgaW50ZWdyaXR5IGNvbmNlcm5zIHJlcXVpcmluZyBhdHRlbnRpb24nXG4gIH0gZWxzZSBpZiAoc2NvcmUgPj0gNDApIHtcbiAgICBsZXZlbCA9ICdQT09SJ1xuICAgIGRlc2NyaXB0aW9uID0gJ1NpZ25pZmljYW50IGludGVncml0eSBpc3N1ZXMgcmVxdWlyaW5nIGltbWVkaWF0ZSBhY3Rpb24nXG4gIH0gZWxzZSB7XG4gICAgbGV2ZWwgPSAnQ1JJVElDQUwnXG4gICAgZGVzY3JpcHRpb24gPSAnQ3JpdGljYWwgaW50ZWdyaXR5IHZpb2xhdGlvbnMgcmVxdWlyaW5nIHVyZ2VudCBpbnRlcnZlbnRpb24nXG4gIH1cblxuICByZXR1cm4geyBzY29yZSwgbGV2ZWwsIGRlc2NyaXB0aW9uIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJwcmlzbWEiLCJyZXF1aXJlUm9sZSIsIkdFVCIsInJlcXVlc3QiLCJzZXNzaW9uIiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwicXVpeklkIiwiZ2V0IiwidGltZVJhbmdlIiwicGFyc2VJbnQiLCJ1c2VySWQiLCJzdGFydERhdGUiLCJEYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJ3aGVyZUNvbmRpdGlvbnMiLCJ0aW1lc3RhbXAiLCJndGUiLCJxdWl6Um9vbXMiLCJjaGF0Um9vbSIsImZpbmRNYW55Iiwid2hlcmUiLCJzZWxlY3QiLCJpZCIsInJvb21JZCIsImluIiwibWFwIiwicm9vbSIsInN1c3BpY2lvdXNBY3Rpdml0aWVzIiwic3VzcGljaW91c0FjdGl2aXR5IiwiaW5jbHVkZSIsInVzZXIiLCJuYW1lIiwiZW1haWwiLCJyb2xlIiwidHlwZSIsInF1aXoiLCJ0aXRsZSIsIm1lc3NhZ2UiLCJjb250ZW50IiwiY3JlYXRlZEF0Iiwib3JkZXJCeSIsInBhdHRlcm5BbmFseXNpcyIsImFuYWx5emVWaW9sYXRpb25QYXR0ZXJucyIsInVzZXJSaXNrQXNzZXNzbWVudCIsImdlbmVyYXRlVXNlclJpc2tBc3Nlc3NtZW50IiwicXVpekFuYWx5c2lzIiwiYW5hbHl6ZVF1aXpJbnRlZ3JpdHkiLCJyZWNvbW1lbmRhdGlvbnMiLCJnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyIsInN1bW1hcnkiLCJ0b3RhbFZpb2xhdGlvbnMiLCJsZW5ndGgiLCJoaWdoU2V2ZXJpdHlWaW9sYXRpb25zIiwiZmlsdGVyIiwiYSIsInNldmVyaXR5IiwibWVkaXVtU2V2ZXJpdHlWaW9sYXRpb25zIiwibG93U2V2ZXJpdHlWaW9sYXRpb25zIiwicmVzb2x2ZWRWaW9sYXRpb25zIiwicmVzb2x2ZWQiLCJ1bmlxdWVVc2VycyIsIlNldCIsInNpemUiLCJ1bmlxdWVRdWl6emVzIiwiQm9vbGVhbiIsImludGVncml0eVNjb3JlIiwiY2FsY3VsYXRlSW50ZWdyaXR5U2NvcmUiLCJqc29uIiwiYWN0aXZpdHkiLCJkZXNjcmlwdGlvbiIsImV2aWRlbmNlIiwiSlNPTiIsInBhcnNlIiwiZXJyb3IiLCJjb25zb2xlIiwic3RhdHVzIiwidmlvbGF0aW9uc0J5VHlwZSIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsInZpb2xhdGlvbnNCeUhvdXIiLCJob3VybHlEaXN0cmlidXRpb24iLCJyZWR1Y2UiLCJhY2MiLCJ2aW9sYXRpb24iLCJob3VyIiwiZ2V0SG91cnMiLCJ0b3RhbCIsImhpZ2giLCJtZWRpdW0iLCJsb3ciLCJ0b0xvd2VyQ2FzZSIsInJlcGVhdE9mZmVuZGVycyIsImhhdmluZyIsImd0Iiwib2ZmZW5kZXJEZXRhaWxzIiwib2ZmZW5kZXIiLCJpdGVtIiwiY291bnQiLCJmaW5kIiwidmlvbGF0aW9uQ291bnQiLCJ1c2VyVmlvbGF0aW9ucyIsInVzZXJSaXNrU2NvcmVzIiwidXNlcklkcyIsIk9iamVjdCIsImtleXMiLCJ1c2VycyIsInZpb2xhdGlvbnMiLCJyaXNrU2NvcmUiLCJyaXNrTGV2ZWwiLCJNYXRoIiwicm91bmQiLCJzb3J0IiwiYiIsImZpbmRVbmlxdWUiLCJjaGF0Um9vbXMiLCJhdHRlbXB0cyIsImZsYXRNYXAiLCJhdHRlbXB0VXNlcnMiLCJhdHRlbXB0IiwidmlvbGF0aW9uVXNlcnMiLCJjb21wcm9taXNlZEF0dGVtcHRzIiwiaW5jbHVkZXMiLCJxdWl6VGl0bGUiLCJ0b3RhbEF0dGVtcHRzIiwibWF4IiwiYWN0aXZpdGllcyIsInBhdHRlcm5zIiwiaGlnaFNldmVyaXR5Q291bnQiLCJwdXNoIiwicGVha1Zpb2xhdGlvbkhvdXIiLCJlbnRyaWVzIiwia2V5d29yZFZpb2xhdGlvbnMiLCJ2IiwidGltaW5nVmlvbGF0aW9ucyIsInNjb3JlIiwibGV2ZWwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/reports/academic-integrity/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getSession: () => (/* binding */ getSession),\n/* harmony export */   requireAuth: () => (/* binding */ requireAuth),\n/* harmony export */   requireRole: () => (/* binding */ requireRole)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n\nasync function getSession() {\n    try {\n        const cookieStore = (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n        const sessionCookie = cookieStore.get(\"user-session\");\n        if (!sessionCookie || !sessionCookie.value) {\n            return null;\n        }\n        // Validate that the cookie value is not empty or malformed\n        if (sessionCookie.value.trim() === \"\") {\n            return null;\n        }\n        const session = JSON.parse(sessionCookie.value);\n        // Validate that the session has required fields\n        if (!session || !session.id || !session.email || !session.name || !session.role) {\n            console.warn(\"Invalid session structure:\", session);\n            return null;\n        }\n        return session;\n    } catch (error) {\n        console.error(\"Error getting session:\", error);\n        return null;\n    }\n}\nasync function requireAuth() {\n    const session = await getSession();\n    if (!session) {\n        throw new Error(\"Authentication required\");\n    }\n    return session;\n}\nasync function requireRole(role) {\n    const session = await requireAuth();\n    if (session.role !== role) {\n        throw new Error(`Access denied. Required role: ${role}`);\n    }\n    return session;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFzQztBQVUvQixlQUFlQztJQUNwQixJQUFJO1FBQ0YsTUFBTUMsY0FBY0YscURBQU9BO1FBQzNCLE1BQU1HLGdCQUFnQkQsWUFBWUUsR0FBRyxDQUFDO1FBRXRDLElBQUksQ0FBQ0QsaUJBQWlCLENBQUNBLGNBQWNFLEtBQUssRUFBRTtZQUMxQyxPQUFPO1FBQ1Q7UUFFQSwyREFBMkQ7UUFDM0QsSUFBSUYsY0FBY0UsS0FBSyxDQUFDQyxJQUFJLE9BQU8sSUFBSTtZQUNyQyxPQUFPO1FBQ1Q7UUFFQSxNQUFNQyxVQUFVQyxLQUFLQyxLQUFLLENBQUNOLGNBQWNFLEtBQUs7UUFFOUMsZ0RBQWdEO1FBQ2hELElBQUksQ0FBQ0UsV0FBVyxDQUFDQSxRQUFRRyxFQUFFLElBQUksQ0FBQ0gsUUFBUUksS0FBSyxJQUFJLENBQUNKLFFBQVFLLElBQUksSUFBSSxDQUFDTCxRQUFRTSxJQUFJLEVBQUU7WUFDL0VDLFFBQVFDLElBQUksQ0FBQyw4QkFBOEJSO1lBQzNDLE9BQU87UUFDVDtRQUVBLE9BQU9BO0lBQ1QsRUFBRSxPQUFPUyxPQUFPO1FBQ2RGLFFBQVFFLEtBQUssQ0FBQywwQkFBMEJBO1FBQ3hDLE9BQU87SUFDVDtBQUNGO0FBRU8sZUFBZUM7SUFDcEIsTUFBTVYsVUFBVSxNQUFNTjtJQUN0QixJQUFJLENBQUNNLFNBQVM7UUFDWixNQUFNLElBQUlXLE1BQU07SUFDbEI7SUFDQSxPQUFPWDtBQUNUO0FBRU8sZUFBZVksWUFBWU4sSUFBYztJQUM5QyxNQUFNTixVQUFVLE1BQU1VO0lBQ3RCLElBQUlWLFFBQVFNLElBQUksS0FBS0EsTUFBTTtRQUN6QixNQUFNLElBQUlLLE1BQU0sQ0FBQyw4QkFBOEIsRUFBRUwsS0FBSyxDQUFDO0lBQ3pEO0lBQ0EsT0FBT047QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL3F1aXotbWFuYWdlbWVudC1zeXN0ZW0vLi9zcmMvbGliL2F1dGgudHM/NjY5MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb29raWVzIH0gZnJvbSAnbmV4dC9oZWFkZXJzJ1xuaW1wb3J0IHsgVXNlclJvbGUgfSBmcm9tICdAL3R5cGVzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIFNlc3Npb25Vc2VyIHtcbiAgaWQ6IHN0cmluZ1xuICBlbWFpbDogc3RyaW5nXG4gIG5hbWU6IHN0cmluZ1xuICByb2xlOiBVc2VyUm9sZVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2Vzc2lvbigpOiBQcm9taXNlPFNlc3Npb25Vc2VyIHwgbnVsbD4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNvb2tpZVN0b3JlID0gY29va2llcygpXG4gICAgY29uc3Qgc2Vzc2lvbkNvb2tpZSA9IGNvb2tpZVN0b3JlLmdldCgndXNlci1zZXNzaW9uJylcbiAgICBcbiAgICBpZiAoIXNlc3Npb25Db29raWUgfHwgIXNlc3Npb25Db29raWUudmFsdWUpIHtcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgdGhhdCB0aGUgY29va2llIHZhbHVlIGlzIG5vdCBlbXB0eSBvciBtYWxmb3JtZWRcbiAgICBpZiAoc2Vzc2lvbkNvb2tpZS52YWx1ZS50cmltKCkgPT09ICcnKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIGNvbnN0IHNlc3Npb24gPSBKU09OLnBhcnNlKHNlc3Npb25Db29raWUudmFsdWUpXG4gICAgXG4gICAgLy8gVmFsaWRhdGUgdGhhdCB0aGUgc2Vzc2lvbiBoYXMgcmVxdWlyZWQgZmllbGRzXG4gICAgaWYgKCFzZXNzaW9uIHx8ICFzZXNzaW9uLmlkIHx8ICFzZXNzaW9uLmVtYWlsIHx8ICFzZXNzaW9uLm5hbWUgfHwgIXNlc3Npb24ucm9sZSkge1xuICAgICAgY29uc29sZS53YXJuKCdJbnZhbGlkIHNlc3Npb24gc3RydWN0dXJlOicsIHNlc3Npb24pXG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIHJldHVybiBzZXNzaW9uXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyBzZXNzaW9uOicsIGVycm9yKVxuICAgIHJldHVybiBudWxsXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlcXVpcmVBdXRoKCk6IFByb21pc2U8U2Vzc2lvblVzZXI+IHtcbiAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb24oKVxuICBpZiAoIXNlc3Npb24pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJylcbiAgfVxuICByZXR1cm4gc2Vzc2lvblxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVxdWlyZVJvbGUocm9sZTogVXNlclJvbGUpOiBQcm9taXNlPFNlc3Npb25Vc2VyPiB7XG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCByZXF1aXJlQXV0aCgpXG4gIGlmIChzZXNzaW9uLnJvbGUgIT09IHJvbGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEFjY2VzcyBkZW5pZWQuIFJlcXVpcmVkIHJvbGU6ICR7cm9sZX1gKVxuICB9XG4gIHJldHVybiBzZXNzaW9uXG59XG4iXSwibmFtZXMiOlsiY29va2llcyIsImdldFNlc3Npb24iLCJjb29raWVTdG9yZSIsInNlc3Npb25Db29raWUiLCJnZXQiLCJ2YWx1ZSIsInRyaW0iLCJzZXNzaW9uIiwiSlNPTiIsInBhcnNlIiwiaWQiLCJlbWFpbCIsIm5hbWUiLCJyb2xlIiwiY29uc29sZSIsIndhcm4iLCJlcnJvciIsInJlcXVpcmVBdXRoIiwiRXJyb3IiLCJyZXF1aXJlUm9sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) globalForPrisma.prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBNkM7QUFFN0MsTUFBTUMsa0JBQWtCQztBQUlqQixNQUFNQyxTQUFTRixnQkFBZ0JFLE1BQU0sSUFBSSxJQUFJSCx3REFBWUEsR0FBRTtBQUVsRSxJQUFJSSxJQUF5QixFQUFjSCxnQkFBZ0JFLE1BQU0sR0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9xdWl6LW1hbmFnZW1lbnQtc3lzdGVtLy4vc3JjL2xpYi9wcmlzbWEudHM/MDFkNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcblxuY29uc3QgZ2xvYmFsRm9yUHJpc21hID0gZ2xvYmFsVGhpcyBhcyB1bmtub3duIGFzIHtcbiAgcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWRcbn1cblxuZXhwb3J0IGNvbnN0IHByaXNtYSA9IGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPz8gbmV3IFByaXNtYUNsaWVudCgpXG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID0gcHJpc21hXG4iXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwiZ2xvYmFsRm9yUHJpc21hIiwiZ2xvYmFsVGhpcyIsInByaXNtYSIsInByb2Nlc3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Freports%2Facademic-integrity%2Froute&page=%2Fapi%2Freports%2Facademic-integrity%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Freports%2Facademic-integrity%2Froute.ts&appDir=C%3A%5CUsers%5CHP%5CDocuments%5CInfTech-quiz-management-system%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CHP%5CDocuments%5CInfTech-quiz-management-system&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();