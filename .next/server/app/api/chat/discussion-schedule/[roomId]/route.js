"use strict";(()=>{var e={};e.id=4936,e.ids=[4936],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48616:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>z,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>l,PUT:()=>d});var i=r(49303),n=r(88716),o=r(60670),a=r(87070),u=r(13538),c=r(95456);async function l(e,{params:t}){try{await (0,c.MH)("ADMIN");let{roomId:e}=t,r=await u._.chatRoom.findUnique({where:{id:e},include:{quiz:{select:{id:!0,title:!0,chatSettings:!0,startAt:!0,timeLimit:!0}}}});if(!r)return a.NextResponse.json({error:"Room not found"},{status:404});let s=null;if(r.quiz?.chatSettings)try{s=JSON.parse(r.quiz.chatSettings)}catch(e){console.error("Error parsing chat settings:",e)}return a.NextResponse.json({room:r,chatSettings:s,currentMode:p(r.quiz,s)})}catch(e){return console.error("Error fetching discussion schedule:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}async function d(e,{params:t}){try{await (0,c.MH)("ADMIN");let{roomId:r}=t,{preQuizDiscussion:s,postQuizDiscussion:i,duringQuizRestriction:n,allowedDiscussionTopics:o}=await e.json(),l=await u._.chatRoom.findUnique({where:{id:r},include:{quiz:!0}});if(!l||!l.quiz)return a.NextResponse.json({error:"Quiz room not found"},{status:404});let d={preQuizDiscussion:{enabled:s?.enabled||!1,startTime:s?.startTime||null,endTime:s?.endTime||null,topics:s?.topics||[]},postQuizDiscussion:{enabled:i?.enabled||!1,startTime:i?.startTime||null,endTime:i?.endTime||null,allowAnswerSharing:i?.allowAnswerSharing||!1},duringQuizRestriction:{enabled:n?.enabled||!0,allowedMessageTypes:n?.allowedMessageTypes||[],emergencyContactAllowed:n?.emergencyContactAllowed||!0},allowedDiscussionTopics:o||[]};return await u._.quiz.update({where:{id:l.quiz.id},data:{chatSettings:JSON.stringify(d)}}),a.NextResponse.json({success:!0,chatSettings:d,currentMode:p(l.quiz,d)})}catch(e){return console.error("Error updating discussion schedule:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}function p(e,t){if(!e||!t)return"normal";let r=new Date,s=e.startAt?new Date(e.startAt):null,i=s&&e.timeLimit?new Date(s.getTime()+6e4*e.timeLimit):null;if(s&&i&&r>=s&&r<=i)return t.duringQuizRestriction?.enabled?"exam":"normal";if(t.preQuizDiscussion?.enabled){let e=t.preQuizDiscussion.startTime?new Date(t.preQuizDiscussion.startTime):null,i=t.preQuizDiscussion.endTime?new Date(t.preQuizDiscussion.endTime):s;if(e&&i&&r>=e&&r<=i)return"pre-quiz"}if(t.postQuizDiscussion?.enabled&&i){let e=t.postQuizDiscussion.startTime?new Date(t.postQuizDiscussion.startTime):i,s=t.postQuizDiscussion.endTime?new Date(t.postQuizDiscussion.endTime):null;if(e&&r>=e&&(!s||r<=s))return"post-quiz"}return"normal"}let m=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/chat/discussion-schedule/[roomId]/route",pathname:"/api/chat/discussion-schedule/[roomId]",filename:"route",bundlePath:"app/api/chat/discussion-schedule/[roomId]/route"},resolvedPagePath:"C:\\Users\\HP\\Documents\\InfTech-quiz-management-system\\src\\app\\api\\chat\\discussion-schedule\\[roomId]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:w}=m,f="/api/chat/discussion-schedule/[roomId]/route";function z(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:g})}},95456:(e,t,r)=>{r.d(t,{Gg:()=>i,MH:()=>o});var s=r(71615);async function i(){try{let e=(0,s.cookies)().get("user-session");if(!e||!e.value||""===e.value.trim())return null;let t=JSON.parse(e.value);if(!t||!t.id||!t.email||!t.name||!t.role)return console.warn("Invalid session structure:",t),null;return t}catch(e){return console.error("Error getting session:",e),null}}async function n(){let e=await i();if(!e)throw Error("Authentication required");return e}async function o(e){let t=await n();if(t.role!==e)throw Error(`Access denied. Required role: ${e}`);return t}},13538:(e,t,r)=>{r.d(t,{_:()=>i});var s=r(53524);let i=globalThis.prisma??new s.PrismaClient}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,1615,5972],()=>r(48616));module.exports=s})();