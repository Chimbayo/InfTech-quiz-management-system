"use strict";(()=>{var e={};e.id=6615,e.ids=[6615],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},89925:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var r={};s.r(r),s.d(r,{GET:()=>d,POST:()=>p});var i=s(49303),o=s(88716),n=s(60670),a=s(87070),c=s(13538),u=s(95456),l=s(83961);async function d(e,{params:t}){try{if(!await (0,u.Gg)())return a.NextResponse.json({error:"Unauthorized"},{status:401});let s=t.id,{searchParams:r}=new URL(e.url),i=parseInt(r.get("limit")||"50"),o=parseInt(r.get("offset")||"0");if(!await c._.chatRoom.findUnique({where:{id:s}}))return a.NextResponse.json({error:"Room not found"},{status:404});let n=await c._.chatMessage.findMany({where:{roomId:s},include:{user:{select:{id:!0,name:!0,role:!0}}},orderBy:{createdAt:"desc"},take:i,skip:o});return a.NextResponse.json(n.reverse())}catch(e){return console.error("Error fetching messages:",e),a.NextResponse.json({error:"Failed to fetch messages"},{status:500})}}async function p(e,{params:t}){try{let s=await (0,u.Gg)();if(!s)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.id,{content:i,replyToId:o}=await e.json();if(!i||!i.trim())return a.NextResponse.json({error:"Message content is required"},{status:400});let n=await c._.chatRoom.findUnique({where:{id:r},include:{quiz:!0}});if(!n)return a.NextResponse.json({error:"Room not found"},{status:404});if(!n.isActive)return a.NextResponse.json({error:"Room is not active"},{status:403});await (0,l.j0)(i,s.id,r);let d=await c._.chatMessage.create({data:{roomId:r,userId:s.id,content:i.trim(),replyToId:o||void 0},include:{user:{select:{id:!0,name:!0,role:!0}}}});return a.NextResponse.json(d,{status:201})}catch(e){return console.error("Error creating message:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/chat/rooms/[id]/messages/route",pathname:"/api/chat/rooms/[id]/messages",filename:"route",bundlePath:"app/api/chat/rooms/[id]/messages/route"},resolvedPagePath:"C:\\Users\\HP\\Documents\\InfTech-quiz-management-system\\src\\app\\api\\chat\\rooms\\[id]\\messages\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:f}=m,w="/api/chat/rooms/[id]/messages/route";function y(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},83961:(e,t,s)=>{s.d(t,{Af:()=>i,j0:()=>n,zt:()=>o});let r=["answer","answers","solution","solutions","cheat","cheating","copy","copying","share","sharing","help me","give me","question","questions","what is","which one","correct answer","right answer","wrong answer","option a","option b","option c","option d","choice a","choice b","choice c","choice d","plagiarize","plagiarism","steal","stolen","fake","fabricate","lie","lying","dishonest","fraud","fraudulent","together","collaborate","work together","team up","group work","split up","divide","you do","i do","take turns","google","search","look up","find online","internet","website","chatgpt","ai","artificial intelligence","bot","automated","more time","extra time","extend","extension","pause","stop timer","reset","restart","technical issue","computer problem"];function i(e){let t=e.toLowerCase(),s=[];for(let e of r)t.includes(e.toLowerCase())&&s.push(e);let i="LOW";if(s.length>=3)i="HIGH";else if(s.length>=2)i="MEDIUM";else if(s.length>=1){let e=["cheat","answer","solution","copy","share"];i=s.some(t=>e.some(e=>t.toLowerCase().includes(e)))?"HIGH":"LOW"}return{isSuspicious:s.length>0,matchedKeywords:s,severity:i}}function o(e){let t=e.filter(e=>"HIGH"===e.severity).length,s=e.filter(e=>"MEDIUM"===e.severity).length,r=e.filter(e=>"LOW"===e.severity).length,i="LOW",o="No significant integrity concerns detected.",n=[];return t>0?(i="HIGH",o=`${t} high-risk activities detected. Immediate review recommended.`,n.push("Review flagged messages immediately"),n.push("Consider invalidating quiz attempts if cheating is confirmed"),n.push("Contact affected students for clarification")):s>2?(i="HIGH",o=`${s} medium-risk activities detected. Pattern suggests potential issues.`,n.push("Review message patterns for academic dishonesty"),n.push("Monitor students more closely in future assessments")):(s>0||r>3)&&(i="MEDIUM",o=`${s+r} suspicious activities detected. Monitoring recommended.`,n.push("Keep records of flagged activities"),n.push("Consider additional proctoring measures")),e.some(e=>"TIMING_VIOLATION"===e.type)&&n.push("Ensure chat restrictions during quizzes are properly enforced"),e.some(e=>"KEYWORD_MATCH"===e.type)&&n.push("Review chat content for academic integrity violations"),{riskLevel:i,summary:o,recommendations:n}}async function n(e,t,s){let r=[],o=i(e);return o.isSuspicious&&r.push({type:"KEYWORD_MATCH",severity:o.severity,description:`Suspicious keywords detected: ${o.matchedKeywords.join(", ")}`,evidence:o.matchedKeywords,timestamp:new Date,userId:t,roomId:s}),{isFlagged:r.length>0,severity:r.length>0?r[0].severity:"LOW",activities:r}}},95456:(e,t,s)=>{s.d(t,{Gg:()=>i,MH:()=>n});var r=s(71615);async function i(){try{let e=(0,r.cookies)().get("user-session");if(!e||!e.value||""===e.value.trim())return null;let t=JSON.parse(e.value);if(!t||!t.id||!t.email||!t.name||!t.role)return console.warn("Invalid session structure:",t),null;return t}catch(e){return console.error("Error getting session:",e),null}}async function o(){let e=await i();if(!e)throw Error("Authentication required");return e}async function n(e){let t=await o();if(t.role!==e)throw Error(`Access denied. Required role: ${e}`);return t}},13538:(e,t,s)=>{s.d(t,{_:()=>i});var r=s(53524);let i=globalThis.prisma??new r.PrismaClient}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[9276,1615,5972],()=>s(89925));module.exports=r})();