"use strict";(()=>{var e={};e.id=5587,e.ids=[5587],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},28228:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>T,patchFetch:()=>R,requestAsyncStorage:()=>f,routeModule:()=>q,serverHooks:()=>y,staticGenerationAsyncStorage:()=>w});var n={};r.r(n),r.d(n,{GET:()=>d});var i=r(49303),a=r(88716),u=r(60670),s=r(87070),l=r(13538),o=r(95456);let c={STUDY_STREAK:{name:"Study Streak Master",description:"Complete quizzes on consecutive days",levels:[{level:1,requirement:3,badge:"\uD83D\uDD25",title:"Getting Started"},{level:2,requirement:7,badge:"\uD83C\uDF1F",title:"Week Warrior"},{level:3,requirement:14,badge:"\uD83D\uDC8E",title:"Fortnight Fighter"},{level:4,requirement:30,badge:"\uD83D\uDC51",title:"Monthly Master"}]},PEER_HELPER:{name:"Peer Helper",description:"Help other students in chat discussions",levels:[{level:1,requirement:5,badge:"\uD83E\uDD1D",title:"Helpful Friend"},{level:2,requirement:15,badge:"\uD83D\uDCAA",title:"Study Buddy"},{level:3,requirement:30,badge:"\uD83C\uDF93",title:"Mentor"},{level:4,requirement:50,badge:"\uD83C\uDFC6",title:"Teaching Assistant"}]},QUIZ_MASTERY:{name:"Quiz Mastery",description:"Achieve high scores consistently",levels:[{level:1,requirement:5,badge:"\uD83D\uDCDA",title:"Good Student"},{level:2,requirement:10,badge:"\uD83C\uDFAF",title:"Focused Learner"},{level:3,requirement:20,badge:"\uD83E\uDDE0",title:"Knowledge Seeker"},{level:4,requirement:30,badge:"\uD83C\uDF1F",title:"Quiz Master"}]},STUDY_GROUP_LEADER:{name:"Study Group Leader",description:"Active participation in study groups",levels:[{level:1,requirement:10,badge:"\uD83D\uDC65",title:"Team Player"},{level:2,requirement:25,badge:"\uD83D\uDDE3️",title:"Discussion Leader"},{level:3,requirement:50,badge:"\uD83C\uDFAA",title:"Group Facilitator"},{level:4,requirement:100,badge:"\uD83D\uDC68‍\uD83C\uDFEB",title:"Study Group Champion"}]},CHAT_ENGAGEMENT:{name:"Chat Engagement",description:"Active participation in educational discussions",levels:[{level:1,requirement:20,badge:"\uD83D\uDCAC",title:"Chatty Student"},{level:2,requirement:50,badge:"\uD83D\uDDE8️",title:"Discussion Enthusiast"},{level:3,requirement:100,badge:"\uD83D\uDCE2",title:"Communication Expert"},{level:4,requirement:200,badge:"\uD83C\uDF99️",title:"Chat Champion"}]}};async function d(e){try{let t=await (0,o.Gg)();if(!t?.id)return s.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),n=r.get("userId")||t.id,i=await m(n);return s.NextResponse.json(i)}catch(e){return console.error("Error fetching achievements:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}async function m(e){let t=[],r=await p(e),n=v("STUDY_STREAK",r);n&&t.push({type:"STUDY_STREAK",...n,currentValue:r,earnedAt:new Date});let i=await D(e),a=v("PEER_HELPER",i);a&&t.push({type:"PEER_HELPER",...a,currentValue:i,earnedAt:new Date});let u=await g(e),s=v("QUIZ_MASTERY",u);s&&t.push({type:"QUIZ_MASTERY",...s,currentValue:u,earnedAt:new Date});let l=await E(e),o=v("STUDY_GROUP_LEADER",l);o&&t.push({type:"STUDY_GROUP_LEADER",...o,currentValue:l,earnedAt:new Date});let c=await h(e),d=v("CHAT_ENGAGEMENT",c);return d&&t.push({type:"CHAT_ENGAGEMENT",...d,currentValue:c,earnedAt:new Date}),{achievements:t,totalPoints:t.reduce((e,t)=>e+10*t.level,0),nextAchievements:A(e)}}async function p(e){let t=await l._.quizAttempt.findMany({where:{userId:e,completedAt:{not:null}},orderBy:{completedAt:"desc"},select:{completedAt:!0}});if(0===t.length)return 0;let r=0,n=new Date;for(let e of(n.setHours(0,0,0,0),t)){let t=new Date(e.completedAt);t.setHours(0,0,0,0);let i=Math.floor((n.getTime()-t.getTime())/864e5);if(i===r)r++;else if(i>r)break}return r}async function D(e){return await l._.chatMessage.count({where:{userId:e,OR:[{content:{contains:"help"}},{content:{contains:"explain"}},{content:{contains:"answer"}},{content:{contains:"solution"}},{replyToId:{not:null}}],isDeleted:!1}})}async function g(e){return await l._.quizAttempt.count({where:{userId:e,score:{gte:80},completedAt:{not:null}}})}async function E(e){return await l._.chatMessage.count({where:{userId:e,room:{type:"STUDY_GROUP"},isDeleted:!1}})}async function h(e){return await l._.chatMessage.count({where:{userId:e,isDeleted:!1,isSystemMessage:!1}})}function v(e,t){let r=c[e],n=r.levels.filter(e=>t>=e.requirement);if(0===n.length)return null;let i=n[n.length-1];return{...r,level:i.level,badge:i.badge,title:i.title,requirement:i.requirement}}async function A(e){let t=[];for(let[r,n]of Object.entries(c)){let i=0;switch(r){case"STUDY_STREAK":i=await p(e);break;case"PEER_HELPER":i=await D(e);break;case"QUIZ_MASTERY":i=await g(e);break;case"STUDY_GROUP_LEADER":i=await E(e);break;case"CHAT_ENGAGEMENT":i=await h(e)}let a=n.levels.find(e=>i<e.requirement);a&&t.push({type:r,name:n.name,description:n.description,nextLevel:a.level,nextBadge:a.badge,nextTitle:a.title,requirement:a.requirement,currentValue:i,progress:i/a.requirement*100})}return t}let q=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/gamification/achievements/route",pathname:"/api/gamification/achievements",filename:"route",bundlePath:"app/api/gamification/achievements/route"},resolvedPagePath:"C:\\Users\\HP\\Documents\\InfTech-quiz-management-system\\src\\app\\api\\gamification\\achievements\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:y}=q,T="/api/gamification/achievements/route";function R(){return(0,u.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:w})}},95456:(e,t,r)=>{r.d(t,{Gg:()=>i,MH:()=>u});var n=r(71615);async function i(){try{let e=(0,n.cookies)().get("user-session");if(!e||!e.value||""===e.value.trim())return null;let t=JSON.parse(e.value);if(!t||!t.id||!t.email||!t.name||!t.role)return console.warn("Invalid session structure:",t),null;return t}catch(e){return console.error("Error getting session:",e),null}}async function a(){let e=await i();if(!e)throw Error("Authentication required");return e}async function u(e){let t=await a();if(t.role!==e)throw Error(`Access denied. Required role: ${e}`);return t}},13538:(e,t,r)=>{r.d(t,{_:()=>i});var n=r(53524);let i=globalThis.prisma??new n.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,1615,5972],()=>r(28228));module.exports=n})();