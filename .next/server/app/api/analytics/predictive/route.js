"use strict";(()=>{var e={};e.id=3554,e.ids=[3554],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57580:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>d,staticGenerationAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{GET:()=>u});var i=r(49303),s=r(88716),a=r(60670),c=r(87070),o=r(13538),l=r(95456);async function u(e){try{await (0,l.MH)("ADMIN");let{searchParams:t}=new URL(e.url),r=parseInt(t.get("timeRange")||"90"),n=new Date;n.setDate(n.getDate()-r);let i=await o._.user.findMany({where:{role:"STUDENT"},include:{chatMessages:{where:{createdAt:{gte:n},isDeleted:!1,isSystemMessage:!1},select:{id:!0,createdAt:!0,room:{select:{type:!0,quizId:!0}}}},attempts:{where:{completedAt:{gte:n}},select:{id:!0,score:!0,passed:!0,completedAt:!0,quiz:{select:{id:!0,title:!0,passingScore:!0}}}},studyGroupMemberships:{include:{group:{select:{id:!0,name:!0,createdAt:!0}}}}}}),s=i.map(e=>{let t=function(e){let t=e.length,r=e.filter(e=>"QUIZ_DISCUSSION"===e.room.type).length,n=e.filter(e=>"STUDY_GROUP"===e.room.type).length,i=e.filter(e=>"GENERAL"===e.room.type).length,s=t/(e.length>0?Math.max(1,Math.ceil((new Date().getTime()-new Date(e[0].createdAt).getTime())/864e5)):1),a=[r>0?1:0,n>0?1:0,i>0?1:0].reduce((e,t)=>e+t,0)/3;return{totalMessages:t,quizDiscussionMessages:r,studyGroupMessages:n,generalMessages:i,engagementFrequency:s,diversityScore:a,engagementScore:Math.min(100,10*s+30*a)}}(e.chatMessages),r=function(e){if(0===e.length)return{totalAttempts:0,averageScore:0,passRate:0,improvementTrend:0,consistencyScore:0,recentPerformance:0};let t=e.length,r=e.reduce((e,t)=>e+t.score,0)/t,n=e.filter(e=>e.passed).length/t,i=Math.floor(t/2),s=e.slice(0,i).reduce((e,t)=>e+t.score,0)/Math.max(1,i),a=e.slice(i).reduce((e,t)=>e+t.score,0)/Math.max(1,t-i),c=e.reduce((e,t)=>e+Math.pow(t.score-r,2),0)/t,o=e.slice(-3);return{totalAttempts:t,averageScore:r,passRate:n,improvementTrend:a-s,consistencyScore:Math.max(0,100-Math.sqrt(c)),recentPerformance:o.reduce((e,t)=>e+t.score,0)/o.length}}(e.attempts),n=function(e){let t=e.length;return{activeGroups:t,participationScore:Math.min(100,25*t),hasStudyGroups:t>0}}(e.studyGroupMemberships),i=function(e){let{chatEngagement:t,performanceMetrics:r,studyGroupParticipation:n}=e,i=Math.min(100,r.averageScore),s=t.engagementScore,a=n.participationScore,c=r.consistencyScore;return Math.round(.4*i+.3*s+.2*a+.1*c)}({chatEngagement:t,performanceMetrics:r,studyGroupParticipation:n}),s=function(e){let{chatEngagement:t,performanceMetrics:r,studyGroupParticipation:n,student:i}=e,s=[];return r.averageScore<60&&s.push({type:"LOW_PERFORMANCE",severity:"HIGH",description:"Consistently low quiz scores",value:r.averageScore}),r.improvementTrend<-10&&s.push({type:"DECLINING_PERFORMANCE",severity:"HIGH",description:"Performance declining over time",value:r.improvementTrend}),t.totalMessages<5&&s.push({type:"LOW_ENGAGEMENT",severity:"MEDIUM",description:"Very low chat participation",value:t.totalMessages}),t.engagementFrequency<.1&&s.push({type:"INFREQUENT_PARTICIPATION",severity:"MEDIUM",description:"Infrequent learning activities",value:t.engagementFrequency}),n.hasStudyGroups||s.push({type:"NO_STUDY_GROUPS",severity:"LOW",description:"Not participating in study groups",value:0}),r.consistencyScore<30&&s.push({type:"INCONSISTENT_PERFORMANCE",severity:"MEDIUM",description:"Highly variable quiz performance",value:r.consistencyScore}),s}({chatEngagement:t,performanceMetrics:r,studyGroupParticipation:n,student:e}),a=function(e,t){let r=[];return e.forEach(e=>{switch(e.type){case"LOW_PERFORMANCE":r.push({type:"ACADEMIC_SUPPORT",priority:"HIGH",action:"Schedule one-on-one tutoring session",description:"Provide additional academic support and review study strategies"});break;case"DECLINING_PERFORMANCE":r.push({type:"EARLY_WARNING",priority:"HIGH",action:"Immediate instructor meeting",description:"Address declining performance before it becomes critical"});break;case"LOW_ENGAGEMENT":r.push({type:"ENGAGEMENT_BOOST",priority:"MEDIUM",action:"Encourage chat participation",description:"Send personalized messages to increase discussion involvement"});break;case"NO_STUDY_GROUPS":r.push({type:"SOCIAL_LEARNING",priority:"LOW",action:"Invite to study group",description:"Connect with peers for collaborative learning"});break;case"INCONSISTENT_PERFORMANCE":r.push({type:"STUDY_HABITS",priority:"MEDIUM",action:"Study skills workshop",description:"Help develop consistent study routines and time management"})}}),r}(s,0);return{student:{id:e.id,name:e.name,email:e.email},metrics:{chatEngagement:t,performanceMetrics:r,studyGroupParticipation:n},predictions:{successProbability:i,riskLevel:i>=75?"LOW":i>=50?"MEDIUM":"HIGH",nextQuizSuccessRate:function(e){let{chatEngagement:t,performanceMetrics:r}=e,n=r.improvementTrend>0?10:-5,i=t.engagementScore>50?5:-10,s=r.recentPerformance||r.averageScore;return Math.round(Math.max(0,Math.min(100,s+n+i)))}({chatEngagement:t,performanceMetrics:r})},riskFactors:s,interventions:a}});s.sort((e,t)=>e.predictions.successProbability-t.predictions.successProbability);let a=function(e){let t=e.length,r={excellent:e.filter(e=>e.metrics.performanceMetrics.averageScore>=90).length,good:e.filter(e=>e.metrics.performanceMetrics.averageScore>=80&&e.metrics.performanceMetrics.averageScore<90).length,average:e.filter(e=>e.metrics.performanceMetrics.averageScore>=70&&e.metrics.performanceMetrics.averageScore<80).length,belowAverage:e.filter(e=>e.metrics.performanceMetrics.averageScore<70).length},n={highEngagement:e.filter(e=>e.metrics.chatEngagement.engagementScore>=70).length,moderateEngagement:e.filter(e=>e.metrics.chatEngagement.engagementScore>=40&&e.metrics.chatEngagement.engagementScore<70).length,lowEngagement:e.filter(e=>e.metrics.chatEngagement.engagementScore<40).length},i=e.map(e=>e.metrics.chatEngagement.engagementScore),s=function(e,t){let r=e.length;if(0===r)return 0;let n=e.reduce((e,t)=>e+t,0),i=t.reduce((e,t)=>e+t,0),s=e.reduce((e,r,n)=>e+r*t[n],0),a=e.reduce((e,t)=>e+t*t,0),c=t.reduce((e,t)=>e+t*t,0),o=Math.sqrt((r*a-n*n)*(r*c-i*i));return 0===o?0:(r*s-n*i)/o}(i,e.map(e=>e.metrics.performanceMetrics.averageScore));return{performanceDistribution:r,engagementPatterns:n,correlation:{chatEngagementVsPerformance:s,strength:function(e){let t=Math.abs(e);return t>=.7?"Strong":t>=.3?"Moderate":"Weak"}(s)},trends:{averageImprovement:e.reduce((e,t)=>e+t.metrics.performanceMetrics.improvementTrend,0)/t,studyGroupParticipation:e.filter(e=>e.metrics.studyGroupParticipation.hasStudyGroups).length/t}}}(s),u=function(e){let t=[],r=e.filter(e=>"HIGH"===e.predictions.riskLevel&&e.riskFactors.some(e=>"HIGH"===e.severity));r.length>0&&t.push({type:"CRITICAL_RISK",severity:"HIGH",count:r.length,message:`${r.length} students require immediate intervention`,students:r.map(e=>e.student.name)});let n=e.filter(e=>e.metrics.performanceMetrics.improvementTrend<-15);n.length>0&&t.push({type:"DECLINING_TREND",severity:"MEDIUM",count:n.length,message:`${n.length} students showing significant performance decline`,students:n.map(e=>e.student.name)});let i=e.filter(e=>e.metrics.chatEngagement.totalMessages<3&&e.metrics.performanceMetrics.totalAttempts>0);return i.length>0&&t.push({type:"LOW_ENGAGEMENT",severity:"LOW",count:i.length,message:`${i.length} students with very low engagement`,students:i.map(e=>e.student.name)}),t}(s);return c.NextResponse.json({predictions:s,cohortInsights:a,earlyWarnings:u,summary:{totalStudents:i.length,highRiskStudents:s.filter(e=>"HIGH"===e.predictions.riskLevel).length,mediumRiskStudents:s.filter(e=>"MEDIUM"===e.predictions.riskLevel).length,lowRiskStudents:s.filter(e=>"LOW"===e.predictions.riskLevel).length,averageSuccessProbability:s.reduce((e,t)=>e+t.predictions.successProbability,0)/s.length}})}catch(e){return console.error("Error generating predictive analytics:",e),c.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/analytics/predictive/route",pathname:"/api/analytics/predictive",filename:"route",bundlePath:"app/api/analytics/predictive/route"},resolvedPagePath:"C:\\Users\\HP\\Documents\\InfTech-quiz-management-system\\src\\app\\api\\analytics\\predictive\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:d}=p,h="/api/analytics/predictive/route";function y(){return(0,a.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:g})}},95456:(e,t,r)=>{r.d(t,{Gg:()=>i,MH:()=>a});var n=r(71615);async function i(){try{let e=(0,n.cookies)().get("user-session");if(!e||!e.value||""===e.value.trim())return null;let t=JSON.parse(e.value);if(!t||!t.id||!t.email||!t.name||!t.role)return console.warn("Invalid session structure:",t),null;return t}catch(e){return console.error("Error getting session:",e),null}}async function s(){let e=await i();if(!e)throw Error("Authentication required");return e}async function a(e){let t=await s();if(t.role!==e)throw Error(`Access denied. Required role: ${e}`);return t}},13538:(e,t,r)=>{r.d(t,{_:()=>i});var n=r(53524);let i=globalThis.prisma??new n.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,1615,5972],()=>r(57580));module.exports=n})();